<!DOCTYPE html>
<html>
<head>
<!-- 2015-12-02 Wed 17:48 -->
<meta  charset="utf-8">
<meta  name="viewport" content="width=device-width, initial-scale=1">
<title>Emacs Configurations</title>
<meta  name="generator" content="Org-mode">
<meta  name="author" content="Zhitao Gong">
<meta  name="description" content="Emacs configurations literal programmed in Orgmode."
>
<meta  name="keywords" content="emacs,orgmode,literal programming,emacs-lisp,org">
<link rel="stylesheet" href="https://gongzhitaao.github.io/orgcss/org.css" type="text/css" />
</head>
<body>
<div id="content">
<header>
<h1 class="title">Emacs Configurations</h1>
</header><a href="https://github.com/gongzhitaao/dotemacs"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

<div class="abstract">
<p>
However I organize my Emacs configurations, they all seem a mess to me
after a while.
</p>

</div>

<nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec:introduction">1. Introduction</a></li>
<li><a href="#sec:bootstrap">2. Bootstrap</a></li>
<li><a href="#sec:helper">3. Helper</a></li>
<li><a href="#sec:package">4. Package</a>
<ul>
<li><a href="#sec:gnus">4.1. Gnus</a></li>
<li><a href="#sec:orgmode">4.2. Orgmode</a></li>
<li><a href="#orgheadline1">4.3. Helm</a></li>
<li><a href="#sec:miscpac">4.4. Miscellaneous Packages</a></li>
</ul>
</li>
<li><a href="#sec:editorsetting">5. Editor Setting</a>
<ul>
<li><a href="#sec:encoding_font">5.1. Encoding and Font</a></li>
<li><a href="#sec:default_behaviour">5.2. Default Behaviours</a></li>
<li><a href="#sec:key">5.3. Key bindings</a></li>
</ul>
</li>
<li><a href="#orgheadline2">6. End</a></li>
</ul>
</div>
</nav>

<div id="outline-container-orgheadline3" class="outline-2">
<h2 id="sec:introduction"><a id="orgheadline3"></a><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-sec:introduction">
<p>
This is my Emacs configuration.  Inspired by <a href="http://writequit.org/">Matthew Lee
Hinman</a><sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup> in his <a href="http://writequit.org/org/settings.html">settings</a> employing <a href="https://en.wikipedia.org/wiki/Literate_programming">literal programming</a> in
Orgmode, I store the documentation and configuration code in
<code>README.org</code> file which is loaded <code>init.el</code>.  This project is hosted
on <a href="https://github.com/gongzhitaao/dotemacs">https://github.com/gongzhitaao/dotemacs</a>.
</p>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-2">
<h2 id="sec:bootstrap"><a id="orgheadline4"></a><span class="section-number-2">2</span> Bootstrap</h2>
<div class="outline-text-2" id="text-sec:bootstrap">
<p>
I use <code>emacs.d/init.el</code> to bootstrap all my Emacs configurations.
The only thing done in <code>init.el</code> is to load this file, <code>README.org</code>,
which includes all our documented configurations.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">require</span> '<span style="color: #73d216;">cask</span> <span style="color: #de7fa8;">"~/.cask/cask.el"</span>)
(cask-initialize)
(<span style="color: #729fcf; font-weight: bold;">require</span> '<span style="color: #73d216;">pallet</span>)
(pallet-mode t)
(<span style="color: #729fcf; font-weight: bold;">require</span> '<span style="color: #73d216;">org</span>)
(org-babel-load-file <span style="color: #de7fa8;">"~/.emacs.d/README.org"</span>)
</pre>
</div>

<p>
Notice that I load two packages, <code>cask</code> and <code>pallet</code>, which are
substitution for the builtin package manager<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup>.  For more
information about Cask, please refer to its <a href="http://cask.readthedocs.org/en/latest/">documentation</a>.
</p>

<p>
The <code>use-package</code> is a convenient replacement for <code>require</code>.  It
provides more options and controls on loading packages.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">require</span> '<span style="color: #73d216;">use-package</span>)
</pre>
</div>

<p>
Disable debugging information for package loading.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq use-package-verbose nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-2">
<h2 id="sec:helper"><a id="orgheadline5"></a><span class="section-number-2">3</span> Helper</h2>
<div class="outline-text-2" id="text-sec:helper">
<p>
I start off defining some useful variables.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq user-full-name <span style="color: #de7fa8;">"Zhitao Gong"</span>)
(setq user-mail-address <span style="color: #de7fa8;">"me@gongzhitaao.org"</span>)

(<span style="color: #729fcf; font-weight: bold;">defvar</span> <span style="color: #ff2929;">my-dir</span> (expand-file-name <span style="color: #de7fa8;">"~/Dropbox/dotfiles/emacs.d"</span>)
  <span style="color: #babdb6; font-style: italic;">"The root dir for my Emacs configuration."</span>)
(<span style="color: #729fcf; font-weight: bold;">defvar</span> <span style="color: #ff2929;">my-tmp</span> (expand-file-name <span style="color: #de7fa8;">"tmp"</span> user-emacs-directory)
  <span style="color: #babdb6; font-style: italic;">"Temp files that might be useful but that I don't care about."</span>)
(<span style="color: #729fcf; font-weight: bold;">defvar</span> <span style="color: #ff2929;">my-personal-dir</span> (expand-file-name <span style="color: #de7fa8;">"~/Dropbox/emacs/personal"</span>))
(<span style="color: #729fcf; font-weight: bold;">defvar</span> <span style="color: #ff2929;">my-icons-dir</span> (expand-file-name <span style="color: #de7fa8;">"icons"</span> my-dir)
  <span style="color: #babdb6; font-style: italic;">"Where All the icons are stored."</span>)

(<span style="color: #729fcf; font-weight: bold;">unless</span> (file-exists-p my-tmp) (make-directory my-tmp))
</pre>
</div>

<p>
Then follows some helper functions.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">my-apply-region-or-line</span> (func)
  <span style="color: #babdb6; font-style: italic;">"Apply FUNC to a region, or current line if mark is not</span>
<span style="color: #babdb6; font-style: italic;">      active."</span>
  (<span style="color: #729fcf; font-weight: bold;">save-excursion</span>
    (<span style="color: #729fcf; font-weight: bold;">if</span> (region-active-p)
        (funcall func (region-beginning) (region-end))
      (funcall func (line-beginning-position) (line-end-position)))))

(<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">my-apply-region-or-para</span> (func)
  <span style="color: #babdb6; font-style: italic;">"Apply FUNC to a region, or current paragraph if mark is not active."</span>
  (<span style="color: #729fcf; font-weight: bold;">save-excursion</span>
    (<span style="color: #729fcf; font-weight: bold;">if</span> (not (region-active-p))
        (mark-paragraph))
    (funcall func (region-beginning) (region-end))))

(<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">sort-words</span> (reverse beg end)
  <span style="color: #babdb6; font-style: italic;">"Sort words in region alphabetically, in REVERSE if</span>
<span style="color: #babdb6; font-style: italic;">      negative. Prefixed with negative \\[</span><span style="color: #73d216; font-style: italic;">universal-argument</span><span style="color: #babdb6; font-style: italic;">], sorts</span>
<span style="color: #babdb6; font-style: italic;">      in reverse.</span>

<span style="color: #babdb6; font-style: italic;">        The variable `</span><span style="color: #73d216; font-style: italic;">sort-fold-case</span><span style="color: #babdb6; font-style: italic;">' determines whether alphabetic</span>
<span style="color: #babdb6; font-style: italic;">        case affects the sort order.</span>

<span style="color: #babdb6; font-style: italic;">        See `</span><span style="color: #73d216; font-style: italic;">sort-regexp-fields</span><span style="color: #babdb6; font-style: italic;">'."</span>
  (interactive <span style="color: #de7fa8;">"*P\nr"</span>)
  (sort-regexp-fields reverse <span style="color: #de7fa8;">"</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">(</span><span style="color: #de7fa8;">\\w</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">|</span><span style="color: #de7fa8;">-</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">)</span><span style="color: #de7fa8;">+"</span> <span style="color: #de7fa8;">"\\&amp;"</span> beg end))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline45" class="outline-2">
<h2 id="sec:package"><a id="orgheadline45"></a><span class="section-number-2">4</span> Package</h2>
<div class="outline-text-2" id="text-sec:package">
<p>
This section contains goodies that power my Emacs.
</p>
</div>

<div id="outline-container-orgheadline11" class="outline-3">
<h3 id="sec:gnus"><a id="orgheadline11"></a><span class="section-number-3">4.1</span> Gnus</h3>
<div class="outline-text-3" id="text-sec:gnus">
<blockquote>
<p>
Gnus is a flexible message reader running under GNU Emacs.  It
supports reading and composing both news and mail.  In addition, it
is able to use a number of web-based sources as inputs for its
groups.
</p>
</blockquote>

<p>
I choose Gnus over other GUI or console email client mainly because
it is a builtin to Emacs, which gives me access to most of the
powerful goodies when composing and reading emails.
</p>

<p>
With all that being said, it has a rather steep learning curve, three
years for me.  However, as a heavy Emacs user, it worth the effort.
</p>
</div>

<div id="outline-container-orgheadline6" class="outline-4">
<h4 id="orgheadline6"><span class="section-number-4">4.1.1</span> Tool chain</h4>
<div class="outline-text-4" id="text-4-1-1">
<p>
Gnus can be used to handle all the process of mail, i.e., fetching
mails from server as well as local mail pool, reading mails and
performing various operations on mails and send mails.  However, I
prefer to deligate fetching and serving mails to delicate programs,
<a href="http://offlineimap.org/">offlineimap</a> for fetching and updating mails and <a href="http://www.dovecot.org/">dovecot</a> for serving
mails.
</p>

<p>
Since coordinating and properly configuring the three programs,
<i>dovecot</i>, <i>offlineimap</i> and <i>Gnus</i>, seems a little intricate at
the beginning, all settings are included to make the puzzle more
complete.
</p>

<p>
The whole workflow of this tool chain is as follows.
</p>

<ol class="org-ol">
<li>Offlineimap periodically updates mails in <code>Mail</code> folder,</li>
<li>Dovecot, the mail server, serves mails in <code>Mail</code> at local port
(143 for <i>imap</i> and 993 for <i>imaps</i>), and</li>
<li>Gnus connects to the local ports being listened by Dovecot.</li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline10" class="outline-4">
<h4 id="orgheadline10"><span class="section-number-4">4.1.2</span> Configuration</h4>
<div class="outline-text-4" id="text-4-1-2">
<p>
All configurations to make Gnus work are included in this section.
And I assume that all these programs have been installed
correctly.
</p>
</div>

<div id="outline-container-orgheadline7" class="outline-5">
<h5 id="orgheadline7"><span class="section-number-5">4.1.2.1</span> Dovecot</h5>
<div class="outline-text-5" id="text-4-1-2-1">
<p>
This configuration is relatively simple.  Edit
<code>DOVECOT_DIR/conf.d/10-mail.conf</code>, change the <code>mail_location</code>
</p>

<div class="org-src-container">

<pre class="src src-conf"><span style="color: #babdb6; font-style: italic;">#</span><span style="color: #babdb6; font-style: italic;">mail_location = mbox:~/mail:INBOX=/var/mail/%u</span>
<span style="color: #ff2929;">mail_location</span> = maildir:~/Mail:LAYOUT=fs
</pre>
</div>

<p>
By default dovecot uses Maildir++ directory layout which means
that all mailboxes are stored in a single directory and prefixed
with a dot.  But offlineimap by default works with <code>/</code> (forward
slash), i.e., conventional hierarchical directories.
<code>LAYOUT\=fs</code> tells dovecot to use hierarchical directories.
</p>
</div>
</div>

<div id="outline-container-orgheadline8" class="outline-5">
<h5 id="orgheadline8"><span class="section-number-5">4.1.2.2</span> Offlineimap</h5>
<div class="outline-text-5" id="text-4-1-2-2">
<p>
Offlineimap reads configuration from <code>~/.offlineimaprc</code>.  You can
find a complete configuration sample, <code>offlineimap.conf</code>, shipped
with installation.
</p>

<p>
One thing to note is that offlineimap <i>DOES NOT invoke itself</i>.
In order to periodically update mails, we need to either manually
execute it or use other programs.  I use <i>cron</i> utility to invoke
Offlineimap every 5 minutes, as show in the following code.
</p>

<div class="org-src-container">

<pre class="src src-conf">*/5 * * * * /usr/bin/offlineimap
</pre>
</div>

<p>
My Offlineimap configuration is as follows.
</p>

<div class="org-src-container">

<pre class="src src-conf">[<span style="color: #fce94f; font-weight: bold;">general</span>]

<span style="color: #ff2929;">accounts</span> = Tiger, Gmail, Ymail
<span style="color: #ff2929;">maxsyncaccounts</span> = 4

[<span style="color: #fce94f; font-weight: bold;">Account Tiger</span>]

<span style="color: #ff2929;">localrepository</span> = TigerLocal
<span style="color: #ff2929;">remoterepository</span> = TigerRemote

[<span style="color: #fce94f; font-weight: bold;">Repository TigerLocal</span>]

<span style="color: #ff2929;">type</span> = Maildir
<span style="color: #ff2929;">localfolders</span> = ~/Mail/Tiger
<span style="color: #ff2929;">sep</span> = /

[<span style="color: #fce94f; font-weight: bold;">Repository TigerRemote</span>]

<span style="color: #ff2929;">type</span> = IMAP
<span style="color: #ff2929;">remotehost</span> = outlook.office365.com

<span style="color: #ff2929;">ssl</span> = yes
<span style="color: #ff2929;">sslcacertfile</span> = /etc/ssl/certs/ca-certificates.crt

<span style="color: #ff2929;">remoteport</span> = 993
<span style="color: #ff2929;">remoteuser</span> = my_livemail_address
<span style="color: #ff2929;">createfolders</span> = False

[<span style="color: #fce94f; font-weight: bold;">Account Gmail</span>]

<span style="color: #ff2929;">localrepository</span> = GmailLocal
<span style="color: #ff2929;">remoterepository</span> = GmailRemote

[<span style="color: #fce94f; font-weight: bold;">Repository GmailLocal</span>]

<span style="color: #ff2929;">type</span> = Maildir
<span style="color: #ff2929;">localfolders</span> = ~/Mail/Gmail sep = /

[<span style="color: #fce94f; font-weight: bold;">Repository GmailRemote</span>]

<span style="color: #ff2929;">type</span> = Gmail
<span style="color: #ff2929;">remoteuser</span> = my_gmail_address
<span style="color: #ff2929;">sslcacertfile</span> = /etc/ssl/certs/ca-certificates.crt

[<span style="color: #fce94f; font-weight: bold;">Account Ymail</span>]

<span style="color: #ff2929;">localrepository</span> = YmailLocal
<span style="color: #ff2929;">remoterepository</span> = YmailRemote

[<span style="color: #fce94f; font-weight: bold;">Repository YmailLocal</span>]

<span style="color: #ff2929;">type</span> = Maildir
<span style="color: #ff2929;">localfolders</span> = ~/Mail/Ymail
<span style="color: #ff2929;">sep</span> = /

[<span style="color: #fce94f; font-weight: bold;">Repository YmailRemote</span>]

<span style="color: #ff2929;">type</span> = IMAP
<span style="color: #ff2929;">remotehost</span> = imap.mail.yahoo.com

<span style="color: #ff2929;">ssl</span> = yes
<span style="color: #ff2929;">sslcacertfile</span> = /etc/ssl/certs/ca-certificates.crt

<span style="color: #ff2929;">remoteport</span> = 993
<span style="color: #ff2929;">remoteuser</span> = my_ymail_address
<span style="color: #ff2929;">createfolders</span> = False
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline9" class="outline-5">
<h5 id="orgheadline9"><span class="section-number-5">4.1.2.3</span> Gnus</h5>
<div class="outline-text-5" id="text-4-1-2-3">
<p>
Now comes the workhorse, <i>Gnus</i>.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">gnus</span>
  <span style="color: #729fcf;">:bind</span> (<span style="color: #de7fa8;">"&lt;f12&gt;"</span> . gnus-other-frame)
  <span style="color: #729fcf;">:config</span>
  (setq gnus-init-file (expand-file-name <span style="color: #de7fa8;">"gnus-conf.el"</span> my-dir)))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline12" class="outline-3">
<h3 id="sec:orgmode"><a id="orgheadline12"></a><span class="section-number-3">4.2</span> Orgmode</h3>
<div class="outline-text-3" id="text-sec:orgmode">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">org</span>
  <span style="color: #729fcf;">:if</span> (display-graphic-p)
  <span style="color: #729fcf;">:init</span>
  (<span style="color: #729fcf; font-weight: bold;">let</span> ((my-org-modules
         '(org-bbdb
           org-bibtex
           org-clock
           org-docview
           org-gnus
           org-habit
           org-table
           ox-latex
           ox-bibtex
           ox-beamer)))
    (<span style="color: #729fcf; font-weight: bold;">dolist</span> (m my-org-modules)
      (add-to-list 'org-modules m)))
  <span style="color: #729fcf;">:config</span>
  (mapc 'require org-modules)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Where I add todos.</span>
  (add-hook 'org-mode-hook 'turn-on-auto-fill)

  (setq org-list-description-max-indent 5)

  (add-to-list 'org-structure-template-alist
               '(<span style="color: #de7fa8;">"b"</span> <span style="color: #de7fa8;">"#+BEGIN_abstract\n?\n#+END_abstract"</span> <span style="color: #de7fa8;">""</span>))
  (add-to-list 'org-structure-template-alist '(<span style="color: #de7fa8;">"D"</span> <span style="color: #de7fa8;">"#+DESCRIPTION: ?"</span> <span style="color: #de7fa8;">""</span>))
  (add-to-list 'org-structure-template-alist '(<span style="color: #de7fa8;">"K"</span> <span style="color: #de7fa8;">"#+KEYWORDS: ?"</span> <span style="color: #de7fa8;">""</span>))
  (add-to-list 'org-structure-template-alist '(<span style="color: #de7fa8;">"M"</span> <span style="color: #de7fa8;">"#+MACRO: ?"</span> <span style="color: #de7fa8;">""</span>))
  (add-to-list 'org-structure-template-alist '(<span style="color: #de7fa8;">"O"</span> <span style="color: #de7fa8;">"#+OPTIONS: ?"</span> <span style="color: #de7fa8;">""</span>))
  (add-to-list 'org-structure-template-alist '(<span style="color: #de7fa8;">"T"</span> <span style="color: #de7fa8;">"#+TITLE: ?"</span> <span style="color: #de7fa8;">""</span>))

  (define-key org-mode-map [remap fill-paragraph] #'org-fill-paragraph)

  (setq org-directory (expand-file-name <span style="color: #de7fa8;">"org"</span> my-personal-dir))

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Recursive update todo statistics</span>
  (setq org-hierarchical-todo-statistics nil)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Show events from diary</span>
  (setq org-agenda-include-diary t)

  (setq org-agenda-skip-scheduled-if-deadline-is-shown 'not-today)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Resolve open clocks if the user if idle more than 10 minutes.</span>
  (setq org-clock-idle-time 10)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Sublevels inherit property from parents</span>
  (setq org-use-property-inheritance t)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Fontify src blocks</span>
  (setq org-src-fontify-natively t)
  (setq org-src-preserve-indentation t)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Press enter to follow links</span>
  (setq org-return-follows-link t)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Use prefix key as tag selection</span>
  (setq org-use-fast-todo-selection t)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Bypassing logging if change state with Shift key</span>
  (setq org-treat-S-cursor-todo-selection-as-state-change nil)

  (setq org-todo-keywords
        '((sequence
           <span style="color: #de7fa8;">"TODO(t)"</span> <span style="color: #de7fa8;">"NEXT(n)"</span> <span style="color: #de7fa8;">"|"</span>
           <span style="color: #de7fa8;">"DONE(d!)"</span>)
          (sequence
           <span style="color: #de7fa8;">"WAIT(w@/!)"</span> <span style="color: #de7fa8;">"HOLD(h@/!)"</span> <span style="color: #de7fa8;">"|"</span>
           <span style="color: #de7fa8;">"KILL(k@)"</span>)))

  (setq org-todo-keyword-faces
        '((<span style="color: #de7fa8;">"TODO"</span> <span style="color: #729fcf;">:foreground</span> <span style="color: #de7fa8;">"red"</span> <span style="color: #729fcf;">:weight</span> bold)
          (<span style="color: #de7fa8;">"NEXT"</span> <span style="color: #729fcf;">:foreground</span> <span style="color: #de7fa8;">"cyan"</span> <span style="color: #729fcf;">:weight</span> bold)
          (<span style="color: #de7fa8;">"DONE"</span> <span style="color: #729fcf;">:foreground</span> <span style="color: #de7fa8;">"green"</span> <span style="color: #729fcf;">:weight</span> bold)
          (<span style="color: #de7fa8;">"WAIT"</span> <span style="color: #729fcf;">:foreground</span> <span style="color: #de7fa8;">"yellow"</span> <span style="color: #729fcf;">:weight</span> bold)
          (<span style="color: #de7fa8;">"HOLD"</span> <span style="color: #729fcf;">:foreground</span> <span style="color: #de7fa8;">"magenta"</span> <span style="color: #729fcf;">:weight</span> bold)
          (<span style="color: #de7fa8;">"KILL"</span> <span style="color: #729fcf;">:foreground</span> <span style="color: #de7fa8;">"forest green"</span> <span style="color: #729fcf;">:weight</span> bold)))

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Files to be included in Agenda view.</span>
  (setq org-agenda-files
        (expand-file-name <span style="color: #de7fa8;">"orgfile"</span> org-directory))

  (setq org-agenda-dim-blocked-tasks t)
  (setq org-agenda-compact-blocks t)

  (setq org-agenda-repeating-timestamp-show-all t)
  (setq org-agenda-show-all-dates t)

  (setq org-time-stamp-custom-formats
        '(<span style="color: #de7fa8;">"&lt;%m/%d/%y %a&gt;"</span> . <span style="color: #de7fa8;">"&lt;%Y-%m-%d %a %R %z&gt;"</span>))

  (setq org-agenda-prefix-format
        '((agenda . <span style="color: #de7fa8;">" %i %-12:c%?-12t% s"</span>)
          (timeline . <span style="color: #de7fa8;">"  % s"</span>)
          (todo . <span style="color: #de7fa8;">" %i %-12:T"</span>)
          (tags . <span style="color: #de7fa8;">" %i %-12:T"</span>)
          (search . <span style="color: #de7fa8;">" %i %-12:T"</span>)))

  (setq org-agenda-tags-column -100
        org-habit-graph-column 45
        org-habit-preceding-days 28
        org-habit-following-days 1
        org-agenda-start-with-log-mode t)

  (setq org-clock-history-length 32
        org-clock-in-resume t)
  (setq org-log-into-drawer t
        org-clock-into-drawer t)

  (setq org-clock-persist 't)
  (org-clock-persistence-insinuate)

  (setq org-use-fast-tag-selection nil)

  (setq org-capture-templates
        '((<span style="color: #de7fa8;">"t"</span> <span style="color: #de7fa8;">"New TODO"</span> entry
           (file+headline <span style="color: #de7fa8;">"todo.org.gz"</span> <span style="color: #de7fa8;">"Tasks"</span>)
           <span style="color: #de7fa8;">"* TODO %^{Title} %^G\n %u\n %?\n\n\n"</span>)
          (<span style="color: #de7fa8;">"p"</span> <span style="color: #de7fa8;">"New Project Proposal"</span> entry
           (file+headline <span style="color: #de7fa8;">"proj.org.gz"</span> <span style="color: #de7fa8;">"Projects"</span>)
           <span style="color: #de7fa8;">"* %^{Title} %^G\n %u\n %?\n\n\n"</span>)))

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">(require 'ox-latex)</span>

  (setq org-latex-prefer-user-labels t)

  (setq org-latex-pdf-process
        (quote (<span style="color: #de7fa8;">"texi2dvi --pdf --clean --verbose --batch %f"</span>)))

  (setq org-latex-listings 'minted)
  (add-to-list 'org-latex-packages-alist '(<span style="color: #de7fa8;">""</span> <span style="color: #de7fa8;">"minted"</span>))
  (add-to-list 'org-latex-packages-alist '(<span style="color: #de7fa8;">""</span> <span style="color: #de7fa8;">"microtype"</span>))

  (<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">org-latex-ref-to-cref</span> (text backend info)
    <span style="color: #babdb6; font-style: italic;">"Use \\cref instead of \\ref in latex export."</span>
    (<span style="color: #729fcf; font-weight: bold;">when</span> (org-export-derived-backend-p backend 'latex)
      (replace-regexp-in-string <span style="color: #de7fa8;">"\\\\ref{"</span> <span style="color: #de7fa8;">"\\\\Cref{"</span> text)))

  (add-to-list 'org-export-filter-final-output-functions
               'org-latex-ref-to-cref)

  (setq org-latex-hyperref-template <span style="color: #de7fa8;">"\\hypersetup{</span>
<span style="color: #de7fa8;">      pdfauthor={%a},</span>
<span style="color: #de7fa8;">      pdftitle={%t},</span>
<span style="color: #de7fa8;">      pdfkeywords={%k},</span>
<span style="color: #de7fa8;">      pdfsubject={%d},</span>
<span style="color: #de7fa8;">      pdfcreator={%c},</span>
<span style="color: #de7fa8;">      pdflang={%L},</span>
<span style="color: #de7fa8;">      bookmarks=true,</span>
<span style="color: #de7fa8;">      unicode=true,</span>
<span style="color: #de7fa8;">      pdftoolbar=true,</span>
<span style="color: #de7fa8;">      pdfmenubar=true,</span>
<span style="color: #de7fa8;">      pdffitwindow=false,</span>
<span style="color: #de7fa8;">      pdfstartview={FitW},</span>
<span style="color: #de7fa8;">      pdfnewwindow=true,</span>
<span style="color: #de7fa8;">      colorlinks=true,</span>
<span style="color: #de7fa8;">      linkcolor=red,</span>
<span style="color: #de7fa8;">      citecolor=green,</span>
<span style="color: #de7fa8;">      filecolor=magenta,</span>
<span style="color: #de7fa8;">      urlcolor=cyan}\n"</span>)

  (org-babel-do-load-languages 'org-babel-load-languages
                               '((emacs-lisp . t)
                                 (latex . t)
                                 (python . t)))

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">(require 'ox-beamer)</span>

  (add-to-list 'org-beamer-environments-extra
               '(<span style="color: #de7fa8;">"onlyenv"</span> <span style="color: #de7fa8;">"O"</span> <span style="color: #de7fa8;">"\\begin{onlyenv}%a"</span> <span style="color: #de7fa8;">"\\end{onlyenv}"</span>))

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">(require 'ox-html)</span>

  (setq org-html-doctype <span style="color: #de7fa8;">"html5"</span>
        org-html-html5-fancy t
        org-html-head-include-default-style nil
        org-html-head-include-scripts nil)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Postamble.</span>
  (setq org-html-postamble t
        org-html-postamble-format
        '((<span style="color: #de7fa8;">"en"</span> <span style="color: #de7fa8;">"&lt;a class=\"author\"</span>
<span style="color: #de7fa8;">           href=\"http://gongzhitaao.org\"&gt;%a&lt;/a&gt; / &lt;span</span>
<span style="color: #de7fa8;">           class=\"date\"&gt;%T&lt;/span&gt;&lt;span class=\"creator\"&gt;%c&lt;/span&gt;"</span>)))

  (load-file (expand-file-name <span style="color: #de7fa8;">"my-org-project.el"</span> my-dir)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline1" class="outline-3">
<h3 id="orgheadline1"><span class="section-number-3">4.3</span> Helm</h3>
<div class="outline-text-3" id="text-4-3">
<p>
<a href="https://emacs-helm.github.io/helm/">Helm</a> is really <a href="http://tuhdo.github.io/helm-intro.html">a package in a league of its own</a>.  It deserves a
separete section for all its related configuration.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">defvar</span> <span style="color: #ff2929;">helm-command-prefix-key</span>)
(setq helm-command-prefix-key nil)
(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">helm-config</span>
  <span style="color: #729fcf;">:demand</span>
  <span style="color: #729fcf;">:bind-keymap</span> (<span style="color: #de7fa8;">"C-c h"</span> . helm-command-map))
(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">helm</span>
  <span style="color: #729fcf;">:diminish</span> helm-mode
  <span style="color: #729fcf;">:config</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Some custom helm bindings</span>
  (define-key helm-command-map (kbd <span style="color: #de7fa8;">"a"</span>) #'helm-apropos)
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">c helm-colors</span>
  (define-key helm-command-map (kbd <span style="color: #de7fa8;">"b"</span>) #'helm-bibtex)
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">e helm-etags-select</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">f helm-multi-files</span>
  (define-key helm-command-map (kbd <span style="color: #de7fa8;">"g"</span>) #'helm-do-grep)
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">h help</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">i helm-semantic-or-imenu</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">l helm-locate</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">m helm-man-woman</span>
  (define-key helm-command-map (kbd <span style="color: #de7fa8;">"o"</span>) #'helm-occur)
  (define-key helm-command-map (kbd <span style="color: #de7fa8;">"p"</span>) #'helm-projectile)
  (define-key helm-command-map (kbd <span style="color: #de7fa8;">"SPC"</span>) #'helm-all-mark-rings)
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">r helm-regexp</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">s helm-surfraw</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">t helm-top</span>
  (define-key helm-command-map (kbd <span style="color: #de7fa8;">"w"</span>) #'helm-swoop)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">rebind tab to run persistent action</span>
  (define-key helm-map (kbd <span style="color: #de7fa8;">"&lt;tab&gt;"</span>) 'helm-execute-persistent-action)
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">make TAB works in terminal</span>
  (define-key helm-map (kbd <span style="color: #de7fa8;">"C-i"</span>) 'helm-execute-persistent-action)
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">list actions using C-z</span>
  (define-key helm-map (kbd <span style="color: #de7fa8;">"C-z"</span>)  #'helm-select-action)

  (setq helm-recentf-fuzzy-match t
        helm-buffers-fuzzy-matching t
        helm-split-window-in-side-p t
        helm-ff-search-library-in-sexp t
        helm-ff-file-name-history-use-recentf t
        helm-scroll-amount 8
        helm-completion-in-region-fuzzy-match t
        helm-mode-fuzzy-match t
        helm-M-x-fuzzy-match t)

  (setq helm-semantic-fuzzy-match t
        helm-imenu-fuzzy-match    t)

  (helm-mode +1)
  (helm-autoresize-mode t)

  (<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">helm-bibtex</span>
    <span style="color: #729fcf;">:config</span>
    (setq helm-bibtex-bibliography
          `(,(expand-file-name <span style="color: #de7fa8;">"~/Dropbox/bibliography/sp.bib"</span>)
            ,(expand-file-name <span style="color: #de7fa8;">"~/Dropbox/bibliography/nn.bib"</span>)
            ,(expand-file-name <span style="color: #de7fa8;">"~/Dropbox/bibliography/stats.bib"</span>)))

    (setq helm-bibtex-library-path
          `(,(expand-file-name <span style="color: #de7fa8;">"~/Dropbox/bibliography/sp-pdf"</span>)
            ,(expand-file-name <span style="color: #de7fa8;">"~/Dropbox/bibliography/nn-pdf"</span>)
            ,(expand-file-name <span style="color: #de7fa8;">"~/Dropbox/bibliography/stats-pdf"</span>)))

    (setq helm-bibtex-notes-path
          (expand-file-name <span style="color: #de7fa8;">"~/Dropbox/bibliography/notes"</span>))
    (setq helm-bibtex-notes-extension <span style="color: #de7fa8;">".org"</span>)

    (<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">my-open-pdf-with-evince</span> (path)
      <span style="color: #babdb6; font-style: italic;">"Open pdf files with `</span><span style="color: #73d216; font-style: italic;">evince</span><span style="color: #babdb6; font-style: italic;">' asynchroneously."</span>
      (async-start-process <span style="color: #de7fa8;">"evince"</span> <span style="color: #de7fa8;">"/usr/bin/evince"</span> nil path))
    (setq helm-bibtex-pdf-open-function #'my-open-pdf-with-evince))

  (<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">helm-files</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline44" class="outline-3">
<h3 id="sec:miscpac"><a id="orgheadline44"></a><span class="section-number-3">4.4</span> Miscellaneous Packages</h3>
<div class="outline-text-3" id="text-sec:miscpac">
<p>
The followings are light yet serious functionalities.  Packages
that are wrapped in <code>(when (display-graphic-p) ...)</code> are intended
to be loaded only in GUI mode.  When in console mode, e.g., editing
files through SSH, I only need core editing functions.
</p>
</div>

<div id="outline-container-orgheadline13" class="outline-4">
<h4 id="orgheadline13"><span class="section-number-4">4.4.1</span> Diminish</h4>
<div class="outline-text-4" id="text-4-4-1">
<p>
Make minor modes invisible.  As quoted from Will Mengarini in
<a href="http://www.eskimo.com/~seldon/diminish.el">diminish.el</a>,
</p>

<blockquote>
<p>
When we diminish a mode, we are saying we want it to continue
doing its work for us, but we no longer want to be reminded of it.
It becomes a night worker, like a janitor; it becomes an invisible
man; it remains a component, perhaps an important one, sometimes
an indispensable one, of the mechanism that maintains the
day-people's world, but its place in their thoughts is diminished,
usually to nothing.  As we grow old we diminish more and more such
thoughts, such people, usually to nothing.
</p>
</blockquote>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">diminish</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline14" class="outline-4">
<h4 id="orgheadline14"><span class="section-number-4">4.4.2</span> Ag</h4>
<div class="outline-text-4" id="text-4-4-2">
<p>
Search like crazy.  It is a code-searching tool alternative for ack
related frontend, e.g., ack-and-a-half, which is not actively
maintained anymore.  I included this package but never used before!!
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">ag</span>
  <span style="color: #729fcf;">:defines</span> my-ag-keymap
  <span style="color: #729fcf;">:bind-keymap</span> (<span style="color: #de7fa8;">"C-c a"</span> . my-ag-map)
  <span style="color: #729fcf;">:config</span>

  (setq ag-reuse-buffers t    <span style="color: #babdb6; font-style: italic;">; </span><span style="color: #babdb6; font-style: italic;">Don't spam buffer list with ag buffers</span>
        ag-highlight-search t <span style="color: #babdb6; font-style: italic;">; </span><span style="color: #babdb6; font-style: italic;">A little fanciness</span>

        <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Use Projectile to find the project root</span>
        ag-project-root-function
        (<span style="color: #729fcf; font-weight: bold;">lambda</span> (d)
          (<span style="color: #729fcf; font-weight: bold;">let</span> ((default-directory d))
            (projectile-project-root))))

  (<span style="color: #729fcf; font-weight: bold;">defvar</span> <span style="color: #ff2929;">my-ag-map</span>
    (<span style="color: #729fcf; font-weight: bold;">let</span> ((map (make-sparse-keymap)))
      (define-key map (kbd <span style="color: #de7fa8;">"a"</span>) #'ag-regexp)
      (define-key map (kbd <span style="color: #de7fa8;">"p"</span>) #'ag-project-regexp)

      map)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline15" class="outline-4">
<h4 id="orgheadline15"><span class="section-number-4">4.4.3</span> Anzu</h4>
<div class="outline-text-4" id="text-4-4-3">
<p>
Display in the modeline search information, i.e, <code>(cur/total)</code>,
where <code>cur</code> is the current index of searched keyword and total is
number of totally matched keywords in the current buffer, as shown
in Figure <a href="#orgparagraph1">1</a>.
</p>


<figure id="orgparagraph1">
<p><img src="./img/anzu.png" alt="anzu.png">
</p>
<figcaption><span class="figure-number">Figure 1:</span> Anzu minor mode</figcaption>
</figure>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">anzu</span>
  <span style="color: #729fcf;">:init</span> (global-anzu-mode +1)
  <span style="color: #729fcf;">:diminish</span> anzu-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline16" class="outline-4">
<h4 id="orgheadline16"><span class="section-number-4">4.4.4</span> Appt</h4>
<div class="outline-text-4" id="text-4-4-4">
<blockquote>
<p>
The Emacs diary keeps track of appointments or other events on a
daily basis, in conjunction with the calendar.
</p>
</blockquote>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">when</span> (display-graphic-p)
  (setq diary-file (expand-file-name <span style="color: #de7fa8;">"diary"</span> my-personal-dir)))
</pre>
</div>

<p>
Show diary when I view the calendar.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq calendar-view-diary-initially-flag t)
</pre>
</div>

<p>
Activate appointment management and remind Org agenda as appoinment,
only in GUI mode.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">when</span> (display-graphic-p)
  (appt-activate 1)
  (add-hook 'org-finalize-agenda-hook 'org-agenda-to-appt))
</pre>
</div>

<p>
Display the coming appointment in a notification popup.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">when</span> (display-graphic-p)
  (<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">my-appt-display</span> (mins-till-appt cur-time msg)
    <span style="color: #babdb6; font-style: italic;">"Convinient wrapper for appt popup display"</span>
    (notifications-notify
     <span style="color: #729fcf;">:title</span> (format <span style="color: #de7fa8;">"Appt in %s minute(s)"</span> mins-till-appt)
     <span style="color: #729fcf;">:body</span> msg
     <span style="color: #729fcf;">:app-icon</span> (expand-file-name <span style="color: #de7fa8;">"appointment-soon.png"</span> my-icons-dir)))

  (setq appt-disp-window-function (function my-appt-display)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline17" class="outline-4">
<h4 id="orgheadline17"><span class="section-number-4">4.4.5</span> Async</h4>
<div class="outline-text-4" id="text-4-4-5">
<p>
Async in Emacs?  Cool!
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">async</span>
  <span style="color: #729fcf;">:commands</span> (dired-async-mode)
  <span style="color: #729fcf;">:init</span> (dired-async-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline18" class="outline-4">
<h4 id="orgheadline18"><span class="section-number-4">4.4.6</span> BBDB</h4>
<div class="outline-text-4" id="text-4-4-6">
<p>
<a href="http://savannah.nongnu.org/projects/bbdb/">BBDB</a> (Insidious Big Brother Database) is a rolodex-like database
program for GNU Emacs.  It is mainly used to store contacts.  And it
has nice integration with Gnus.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">bbdb</span>
  <span style="color: #729fcf;">:if</span> (display-graphic-p)
  <span style="color: #729fcf;">:config</span>
  (bbdb-initialize 'gnus 'mail 'message 'anniv)

  (setq bbdb-complete-mail-allow-cycling t
        bbdb-allow-duplicates t
        bbdb-message-all-addresses t
        bbdb-file
        (expand-file-name <span style="color: #de7fa8;">"contacts.bbdb.gz"</span> my-personal-dir))

  (add-hook 'message-setup-hook 'bbdb-mail-aliases))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline19" class="outline-4">
<h4 id="orgheadline19"><span class="section-number-4">4.4.7</span> Deft</h4>
<div class="outline-text-4" id="text-4-4-7">
<blockquote>
<p>
<a href="http://jblevins.org/projects/deft/">Deft</a> is an Emacs mode for quickly browsing, filtering, and editing
directories of plain text notes, inspired by <a href="http://notational.net/">Notational Velocity</a>.
</p>
</blockquote>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">deft</span>
  <span style="color: #729fcf;">:if</span> (display-graphic-p)
  <span style="color: #729fcf;">:bind</span> (<span style="color: #de7fa8;">"&lt;f8&gt;"</span> . deft)
  <span style="color: #729fcf;">:config</span>
  (setq deft-default-extension <span style="color: #de7fa8;">"org"</span>
        deft-directory (expand-file-name <span style="color: #de7fa8;">"notes"</span> my-personal-dir)
        deft-use-filename-as-title nil
        deft-auto-save-interval 0
        deft-strip-title-regexp
        (concat deft-strip-title-regexp
                <span style="color: #de7fa8;">"</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">|</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">(?:</span><span style="color: #de7fa8;">\\+TITLE:[[:space:]]+</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">)</span><span style="color: #de7fa8;">"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline20" class="outline-4">
<h4 id="orgheadline20"><span class="section-number-4">4.4.8</span> Dired</h4>
<div class="outline-text-4" id="text-4-4-8">
<p>
It is a really cool bultin package of which I have not yet leveraged
the full power.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(put 'dired-find-alternate-file 'disabled nil)

<span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">always delete and copy recursively</span>
(setq dired-recursive-deletes 'always
      dired-recursive-copies 'always
      dired-listing-switches <span style="color: #de7fa8;">"-alh"</span>)

(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">dired-x</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline21" class="outline-4">
<h4 id="orgheadline21"><span class="section-number-4">4.4.9</span> Display-time</h4>
<div class="outline-text-4" id="text-4-4-9">
<p>
Display time and unread mail notification in the mode line.  The
unread mail notification is configured in <a href="#sec:gnus">4.1</a>.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq display-time-24hr-format t display-time-day-and-date nil)
(display-time)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline22" class="outline-4">
<h4 id="orgheadline22"><span class="section-number-4">4.4.10</span> Drag-stuff-mode</h4>
<div class="outline-text-4" id="text-4-4-10">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">drag-stuff</span>
  <span style="color: #729fcf;">:bind</span> (<span style="color: #de7fa8;">"C-c d"</span> . drag-stuff-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline23" class="outline-4">
<h4 id="orgheadline23"><span class="section-number-4">4.4.11</span> Eshell</h4>
<div class="outline-text-4" id="text-4-4-11">
<p>
Emacs shell program.  Very handy for remote console access.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">eshell</span>
  <span style="color: #729fcf;">:config</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Truncate eshell buffer just in case you got megabytes of output</span>
  (add-to-list 'eshell-output-filter-functions 'eshell-truncate-buffer)
  (setq eshell-directory-name (expand-file-name <span style="color: #de7fa8;">"eshell"</span> my-tmp)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline24" class="outline-4">
<h4 id="orgheadline24"><span class="section-number-4">4.4.12</span> ESS</h4>
<div class="outline-text-4" id="text-4-4-12">
<blockquote>
<p>
<a href="http://ess.r-project.org/">ESS</a> (Emacs Speaks Statistics) is an add-on package for Emacs text
editors such as GNU Emacs and XEmacs.  It is designed to support
editing of scripts and interaction with various statistical analysis
programs such as R, S-Plus, SAS, Stata and OpenBUGS/JAGS.
</p>
</blockquote>

<p>
I think <a href="http://julialang.org/">Julia</a> is also supported.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">ess-site</span>
  <span style="color: #729fcf;">:config</span>

  (setq ess-R-font-lock-keywords
          '((ess-R-fl-keyword:modifiers . t)
            (ess-R-fl-keyword:fun-defs . t)
            (ess-R-fl-keyword:keywords . t)
            (ess-R-fl-keyword:assign-ops . t)
            (ess-R-fl-keyword:constants . t)
            (ess-fl-keyword:fun-calls)
            (ess-fl-keyword:numbers)
            (ess-fl-keyword:operators)
            (ess-fl-keyword:delimiters)
            (ess-fl-keyword:=)
            (ess-R-fl-keyword:F&amp;T . t)
            (ess-R-fl-keyword:%op% . t)))

  (setq inferior-R-font-lock-keywords
        '((ess-S-fl-keyword:prompt . t)
          (ess-R-fl-keyword:messages . t)
          (ess-R-fl-keyword:modifiers . t)
          (ess-R-fl-keyword:fun-defs . t)
          (ess-R-fl-keyword:keywords . t)
          (ess-R-fl-keyword:assign-ops . t)
          (ess-R-fl-keyword:constants . t)
          (ess-fl-keyword:matrix-labels . t)
          (ess-fl-keyword:fun-calls)
          (ess-fl-keyword:numbers)
          (ess-fl-keyword:operators)
          (ess-fl-keyword:delimiters)
          (ess-fl-keyword:=)
          (ess-R-fl-keyword:F&amp;T . t)))

  (<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">my-ess-init</span> ()
    <span style="color: #babdb6; font-style: italic;">"Init my ess mode."</span>
    (setq ess-help-own-frame 'one)
    (setq ess-tab-complete-in-script t)
    (setq ess-first-tab-never-complete
          'symbol-or-paren-or-punct))

  (add-hook 'ess-mode-hook #'my-ess-init)
  (add-hook 'inferior-ess-mode-hook #'turn-on-smartparens-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline25" class="outline-4">
<h4 id="orgheadline25"><span class="section-number-4">4.4.13</span> Expand-region</h4>
<div class="outline-text-4" id="text-4-4-13">
<p>
Select the region in a DWIW style.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">expand-region</span>
  <span style="color: #729fcf;">:bind</span> (<span style="color: #de7fa8;">"C-="</span> . er/expand-region))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline26" class="outline-4">
<h4 id="orgheadline26"><span class="section-number-4">4.4.14</span> Flycheck</h4>
<div class="outline-text-4" id="text-4-4-14">
<p>
Eamcs Front-end for various languages syntax checker.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">flycheck</span>
  <span style="color: #729fcf;">:if</span> (display-graphic-p)
  <span style="color: #729fcf;">:bind</span> (<span style="color: #de7fa8;">"C-c f"</span> . flycheck-mode)
  <span style="color: #729fcf;">:config</span>
  (<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">my-on-flycheck-status-change</span> (status)
    (<span style="color: #729fcf; font-weight: bold;">let</span> ((fc-icon
           (<span style="color: #729fcf; font-weight: bold;">cond</span>
            ((eq status 'running) [#xF0F4])
            ((eq status 'errored) [#xF00C])
            ((eq status 'finished) [#xF00D]))))
      (diminish #'flycheck-mode (concat <span style="color: #de7fa8;">" "</span> fc-icon))
      (force-mode-line-update)))

  (add-hook 'flycheck-status-changed-functions #'my-on-flycheck-status-change))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline27" class="outline-4">
<h4 id="orgheadline27"><span class="section-number-4">4.4.15</span> Javascript</h4>
<div class="outline-text-4" id="text-4-4-15">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">js2-mode</span>
  <span style="color: #729fcf;">:mode</span> <span style="color: #de7fa8;">"\\.js\\'"</span>
  <span style="color: #729fcf;">:config</span>
  (setq js2-basic-offset 2
        js2-include-node-externs t
        js2-include-browser-externs t))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline28" class="outline-4">
<h4 id="orgheadline28"><span class="section-number-4">4.4.16</span> Hi-mode</h4>
<div class="outline-text-4" id="text-4-4-16">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-hook 'hi-lock-mode-hook
          (<span style="color: #729fcf; font-weight: bold;">lambda</span> () (diminish 'hi-lock-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline29" class="outline-4">
<h4 id="orgheadline29"><span class="section-number-4">4.4.17</span> Ibuffer</h4>
<div class="outline-text-4" id="text-4-4-17">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">ibuffer</span>
  <span style="color: #729fcf;">:config</span>

  (setq ibuffer-saved-filter-groups
        `((<span style="color: #de7fa8;">"default"</span>
           (<span style="color: #de7fa8;">"Planner"</span>
            (or (mode . org-agenda-mode)
                (filename . <span style="color: #de7fa8;">"/home/gongzhitaao/Dropbox/emacs/personal/org/"</span>)
                (name . <span style="color: #de7fa8;">"\\.bbdb"</span>)
                (mode . bbdb-mode)
                (name . <span style="color: #de7fa8;">"^\\*Calendar\\*$"</span>)
                (name . <span style="color: #de7fa8;">"^diary$"</span>)))
           (<span style="color: #de7fa8;">"Dired"</span> (mode . dired-mode))
           (<span style="color: #de7fa8;">"Web"</span>
            (or (name . <span style="color: #de7fa8;">"\\.js"</span>)
                (name . <span style="color: #de7fa8;">"\\.css"</span>)
                (name . <span style="color: #de7fa8;">"\\.html"</span>)
                (name . <span style="color: #de7fa8;">"\\.php"</span>)
                (name . <span style="color: #de7fa8;">"\\.xml"</span>)
                (mode . yaml-mode)))
           (<span style="color: #de7fa8;">"Text"</span>
            (or (name . <span style="color: #de7fa8;">"\\.</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">(</span><span style="color: #de7fa8;">tex</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">|</span><span style="color: #de7fa8;">bib</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">|</span><span style="color: #de7fa8;">csv</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">)</span><span style="color: #de7fa8;">"</span>)
                (mode . org-mode)
                (mode . markdown-mode)
                (mode . text-mode)))
           (<span style="color: #de7fa8;">"Data"</span>
            (or (mode . gnuplot-mode)
                (mode . octave-mode)
                (mode . R-mode)))
           (<span style="color: #de7fa8;">"Coding"</span>
            (or (mode . shell-script-mode)
                (mode . sh-mode)
                (mode . emacs-lisp-mode)
                (name . <span style="color: #de7fa8;">"\\.[ch]</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">(</span><span style="color: #de7fa8;">pp</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">|</span><span style="color: #de7fa8;">xx</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">|</span><span style="color: #de7fa8;">\\+\\+</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">)</span><span style="color: #de7fa8;">?"</span>)
                (mode . python-mode)
                (name . <span style="color: #de7fa8;">"\\.ya?ml"</span>)
                (name . <span style="color: #de7fa8;">"\\.R"</span>)
                (name . <span style="color: #de7fa8;">"\\.lua"</span>)))
           (<span style="color: #de7fa8;">"Mail"</span>
            (or (mode . message-mode)
                (mode . mail-mode)
                (mode . gnus-group-mode)
                (mode . gnus-summary-mode)
                (mode . gnus-article-mode)
                (mode . gnus-server-mode)
                (mode . gnus-browse-mode)
                (name . <span style="color: #de7fa8;">"^\\.newsrc-dribble"</span>)))
           (<span style="color: #de7fa8;">"Console"</span>
            (or (mode . inferior-ess-mode)
                (mode . inferior-python-mode)
                (mode . eshell-mode)
                (mode . gnuplot-comint-mode)
                (mode . comint-mode)))
           (<span style="color: #de7fa8;">"Helper"</span>
            (or (mode . makefile-mode)
                (mode . makefile-gmake-mode)
                (mode . cmake-mode)
                (mode . calc-mode)
                (mode . Info-mode)
                (mode . help-mode)
                (mode . ess-help-mode)
                (name . <span style="color: #de7fa8;">"^\\*scratch\\*$"</span>)))
           (<span style="color: #de7fa8;">"Helm"</span>
            (or (mode . helm-mode))))))

  (add-hook
   'ibuffer-mode-hook
   (<span style="color: #729fcf; font-weight: bold;">lambda</span> ()
     (ibuffer-auto-mode 1)
     (ibuffer-switch-to-saved-filter-groups <span style="color: #de7fa8;">"default"</span>)
     (local-set-key (kbd <span style="color: #de7fa8;">"&lt;right&gt;"</span>) 'ibuffer-forward-filter-group)
     (local-set-key (kbd <span style="color: #de7fa8;">"&lt;left&gt;"</span>) 'ibuffer-backward-filter-group)
     (hl-line-mode 1)))

  (define-ibuffer-column size-h
    (<span style="color: #729fcf;">:name</span> <span style="color: #de7fa8;">"Size"</span> <span style="color: #729fcf;">:inline</span> t)
    (<span style="color: #729fcf; font-weight: bold;">cond</span> ((&gt; (buffer-size) 1000)
           (format <span style="color: #de7fa8;">"%7.1fk"</span> (/ (buffer-size) 1000.0)))
          ((&gt; (buffer-size) 1000000)
           (format <span style="color: #de7fa8;">"%7.1fM"</span> (/ (buffer-size) 1000000.0)))
          (t (format <span style="color: #de7fa8;">"%8dB"</span> (buffer-size)))))

  (setq ibuffer-formats
        '((mark modified read-only <span style="color: #de7fa8;">" "</span>
                (name 18 18 <span style="color: #729fcf;">:left</span> <span style="color: #729fcf;">:elide</span>) <span style="color: #de7fa8;">" "</span>
                (size-h 9 -1 <span style="color: #729fcf;">:right</span>) <span style="color: #de7fa8;">" "</span>
                (mode 16 16 <span style="color: #729fcf;">:left</span> <span style="color: #729fcf;">:elide</span>) <span style="color: #de7fa8;">" "</span>
                filename-and-process))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline30" class="outline-4">
<h4 id="orgheadline30"><span class="section-number-4">4.4.18</span> Lua-mode</h4>
<div class="outline-text-4" id="text-4-4-18">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">lua-mode</span>
  <span style="color: #729fcf;">:mode</span> <span style="color: #de7fa8;">"\\.lua\\'"</span>
  <span style="color: #729fcf;">:config</span>
  (define-key lua-mode-map (kbd <span style="color: #de7fa8;">"C-&lt;return&gt;"</span>) #'lua-send-current-line)
  (define-key lua-mode-map (kbd <span style="color: #de7fa8;">"C-c b"</span>) #'lua-send-buffer)
  (define-key lua-mode-map (kbd <span style="color: #de7fa8;">"C-c C-b"</span>) #'lua-send-buffer)
  (define-key lua-mode-map (kbd <span style="color: #de7fa8;">"C-c f"</span>) #'lua-send-defun)
  (define-key lua-mode-map (kbd <span style="color: #de7fa8;">"C-c C-f"</span>) #'lua-send-defun)
  (define-key lua-mode-map (kbd <span style="color: #de7fa8;">"C-c r"</span>) #'lua-send-region)
  (define-key lua-mode-map (kbd <span style="color: #de7fa8;">"C-c C-r"</span>) #'lua-send-region))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline31" class="outline-4">
<h4 id="orgheadline31"><span class="section-number-4">4.4.19</span> Midnight</h4>
<div class="outline-text-4" id="text-4-4-19">
<p>
What is <code>midnight-mode</code> for?  Included but never used&#x2026;
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">midnight</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline32" class="outline-4">
<h4 id="orgheadline32"><span class="section-number-4">4.4.20</span> Multiple-cursors</h4>
<div class="outline-text-4" id="text-4-4-20">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">multiple-cursors</span>
  <span style="color: #729fcf;">:defines</span> my-multiple-cursors-map
  <span style="color: #729fcf;">:bind-keymap</span> (<span style="color: #de7fa8;">"C-c M"</span> . my-multiple-cursors-map)
  <span style="color: #729fcf;">:config</span>
  (<span style="color: #729fcf; font-weight: bold;">defvar</span> <span style="color: #ff2929;">my-multiple-cursors-map</span>
    (<span style="color: #729fcf; font-weight: bold;">let</span> ((map (make-sparse-keymap)))
      (define-key map (kbd <span style="color: #de7fa8;">"l"</span>) #'mc/edit-lines)
      (define-key map (kbd <span style="color: #de7fa8;">"C-a"</span>) #'mc/edit-beginnings-of-lines)
      (define-key map (kbd <span style="color: #de7fa8;">"C-e"</span>) #'mc/edit-ends-of-lines)
      (define-key map (kbd <span style="color: #de7fa8;">"C-s"</span>) #'mc/mark-all-in-region)
      (define-key map (kbd <span style="color: #de7fa8;">"n"</span>) #'mc/mark-next-like-this)
      (define-key map (kbd <span style="color: #de7fa8;">"p"</span>) #'mc/mark-previous-like-this)
      (define-key map (kbd <span style="color: #de7fa8;">"e"</span>) #'mc/mark-more-like-this-extended)
      (define-key map (kbd <span style="color: #de7fa8;">"h"</span>) #'mc/mark-all-like-this-dwim)
      (define-key map (kbd <span style="color: #de7fa8;">"r"</span>) #'mc/mark-all-in-region-regexp)

      map)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline33" class="outline-4">
<h4 id="orgheadline33"><span class="section-number-4">4.4.21</span> Projectile</h4>
<div class="outline-text-4" id="text-4-4-21">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">projectile</span>
  <span style="color: #729fcf;">:init</span>
  (projectile-global-mode)
  <span style="color: #729fcf;">:config</span>
  (define-key projectile-mode-map [remap projectile-ack] #'projectile-ag)
  (setq projectile-completion-system 'grizzl)
  <span style="color: #729fcf;">:diminish</span> projectile-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline34" class="outline-4">
<h4 id="orgheadline34"><span class="section-number-4">4.4.22</span> Recentf</h4>
<div class="outline-text-4" id="text-4-4-22">
<p>
Save recently opened files.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">recentf</span>
  <span style="color: #729fcf;">:config</span>
  (setq recentf-save-file (expand-file-name <span style="color: #de7fa8;">"recentf"</span> my-tmp))
  (add-to-list 'recentf-exclude (expand-file-name <span style="color: #de7fa8;">".*"</span> my-tmp))
  (add-to-list 'recentf-exclude (expand-file-name <span style="color: #de7fa8;">"elpa/.*"</span> user-emacs-directory))
  (add-to-list 'recentf-exclude (expand-file-name <span style="color: #de7fa8;">"~/.newsrc*"</span>))
  (add-to-list 'recentf-exclude (expand-file-name my-personal-dir))
  (add-to-list 'recentf-exclude (expand-file-name <span style="color: #de7fa8;">".cask/.*"</span> user-emacs-directory))
  (recentf-mode +1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline35" class="outline-4">
<h4 id="orgheadline35"><span class="section-number-4">4.4.23</span> Savehist</h4>
<div class="outline-text-4" id="text-4-4-23">
<p>
Save minibuffer history.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">savehist</span>
  <span style="color: #729fcf;">:init</span>
  (savehist-mode +1)
  <span style="color: #729fcf;">:config</span>
  (setq savehist-additional-variables '(search ring regexp-search-ring)
        savehist-file (expand-file-name <span style="color: #de7fa8;">"savehist"</span> my-tmp)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline36" class="outline-4">
<h4 id="orgheadline36"><span class="section-number-4">4.4.24</span> Saveplace</h4>
<div class="outline-text-4" id="text-4-4-24">
<p>
Save places in a file so that you can go back when you reopen it.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">saveplace</span>
  <span style="color: #729fcf;">:init</span>
  (setq-default save-place t)
  <span style="color: #729fcf;">:config</span>
  (setq save-place-file (expand-file-name <span style="color: #de7fa8;">"saveplace"</span> my-tmp)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline37" class="outline-4">
<h4 id="orgheadline37"><span class="section-number-4">4.4.25</span> Smartparens</h4>
<div class="outline-text-4" id="text-4-4-25">
<blockquote>
<p>
Smartparens is minor mode for Emacs that <i>deals with parens pairs
and tries to be smart about it</i>.
</p>
</blockquote>

<p>
This is a really <i>smart</i> and <i>useful</i> package.  <i>However it takes a
while, maybe quite a while, to get used to its intelligence</i>.  For
most editors (I really mean editors other than Emacs), I can not
imagine I may have all these convenient options of dealing with
parens.  Take as an simple example, kill the ballanced expression.
</p>

<div class="org-src-container">

<pre class="src src-lisp">(func1 (func2 (func3)))
</pre>
</div>

<p>
Suppose you want to delete <code>(func2 ...)</code>, normally I would delete
character by character, or hightlight manually and then delete.
With <i>smartparens</i>, I may place cursor at the opening bracket of
<code>func2</code> and <kbd>M-x</kbd> <code>sp-kill-sexp</code> would kill the whole
<code>func2</code> expression.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">smartparens</span>
  <span style="color: #729fcf;">:init</span>

  (smartparens-global-mode t)
  (show-smartparens-global-mode 1)

  <span style="color: #729fcf;">:diminish</span> smartparens-mode

  <span style="color: #729fcf;">:config</span>

  (<span style="color: #729fcf; font-weight: bold;">sp-with-modes</span>
      '(tex-mode plain-tex-mode latex-mode)
    (sp-local-tag <span style="color: #de7fa8;">"i"</span> <span style="color: #de7fa8;">"\"&lt;"</span> <span style="color: #de7fa8;">"\"&gt;"</span>)
    (sp-local-tag <span style="color: #de7fa8;">"i"</span> <span style="color: #de7fa8;">"\"["</span> <span style="color: #de7fa8;">"\"]"</span>))

  (sp-local-pair '(emacs-lisp-mode lisp-mode) <span style="color: #de7fa8;">"`"</span> <span style="color: #de7fa8;">"'"</span>)
  (sp-local-pair '(emacs-lisp-mode lisp-mode) <span style="color: #de7fa8;">"`"</span>
                 nil <span style="color: #729fcf;">:when</span> '(sp-in-string-p))
  (sp-local-pair '(emacs-lisp-mode lisp-mode) <span style="color: #de7fa8;">"'"</span>
                 nil <span style="color: #729fcf;">:actions</span> nil)

  (setq sp-cancel-autoskip-on-backward-movement nil)
  (setq sp-navigate-consider-stringlike-sexp
        '(lisp-mode emacs-lisp-mode latex-mode LaTeX-mode TeX-mode))

  (set-face-background 'sp-pair-overlay-face <span style="color: #de7fa8;">"DarkGreen"</span>)
  (set-face-background 'sp-show-pair-match-face <span style="color: #de7fa8;">"SteelBlue4"</span>)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s f"</span>) 'sp-forward-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s b"</span>) 'sp-backward-sexp)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s d"</span>) 'sp-down-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s D"</span>) 'sp-backward-down-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s a"</span>) 'sp-beginning-of-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s e"</span>) 'sp-end-of-sexp)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s u"</span>) 'sp-up-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s U"</span>) 'sp-backward-up-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s t"</span>) 'sp-transpose-sexp)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s n"</span>) 'sp-next-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s p"</span>) 'sp-previous-sexp)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s k"</span>) 'sp-kill-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s w"</span>) 'sp-copy-sexp)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s s"</span>) 'sp-forward-slurp-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s r"</span>) 'sp-forward-barf-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s S"</span>) 'sp-backward-slurp-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s R"</span>) 'sp-backward-barf-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s F"</span>) 'sp-forward-symbol)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s B"</span>) 'sp-backward-symbol)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s ["</span>) 'sp-select-previous-thing)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s ]"</span>) 'sp-select-next-thing)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-i"</span>) 'sp-splice-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s &lt;delete&gt;"</span>) 'sp-splice-sexp-killing-forward)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s &lt;backspace&gt;"</span>) 'sp-splice-sexp-killing-backward)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-&lt;backspace&gt;"</span>) 'sp-splice-sexp-killing-around)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-w"</span>) 'sp-wrap)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-u"</span>) 'sp-unwrap-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-b"</span>) 'sp-backward-unwrap-sexp)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-t"</span>) 'sp-prefix-tag-object)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-p"</span>) 'sp-prefix-pair-object)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-c"</span>) 'sp-convolute-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-a"</span>) 'sp-absorb-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-e"</span>) 'sp-emit-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-p"</span>) 'sp-add-to-previous-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-n"</span>) 'sp-add-to-next-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-j"</span>) 'sp-join-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-s"</span>) 'sp-split-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-r"</span>) 'sp-raise-sexp))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline38" class="outline-4">
<h4 id="orgheadline38"><span class="section-number-4">4.4.26</span> Tex</h4>
<div class="outline-text-4" id="text-4-4-26">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq TeX-auto-save t)
(setq TeX-parse-self t)

(setq bibtex-dialect 'biblatex)
(setq bibtex-align-at-equal-sign t)
(setq bibtex-text-indentation 20)

(<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">my-init-bibtex-mode</span> ()
  (local-set-key (kbd <span style="color: #de7fa8;">"C-c \\"</span>) 'bibtex-fill-entry)
  (setq fill-column 140))
(add-hook 'bibtex-mode-hook #'my-init-bibtex-mode)

(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">reftex</span>
  <span style="color: #729fcf;">:diminish</span> reftex-mode
  <span style="color: #729fcf;">:config</span>
  (add-hook 'latex-mode-hook 'turn-on-reftex)
  (add-hook 'LaTeX-mode-hook 'turn-on-reftex)
  (setq reftex-plug-into-AUCTeX t
        reftex-ref-style-default-list '(<span style="color: #de7fa8;">"Cleveref"</span> <span style="color: #de7fa8;">"Hyperref"</span> <span style="color: #de7fa8;">"Fancyref"</span>)
        reftex-default-bibliography
        '(<span style="color: #de7fa8;">"/home/gongzhitaao/Dropbox/bibliography/nn.bib"</span>
          <span style="color: #de7fa8;">"/home/gongzhitaao/Dropbox/bibliography/sp.bib"</span>
          <span style="color: #de7fa8;">"/home/gongzhitaao/Dropbox/bibliography/stats.bib"</span>)))

(add-hook 'latex-mode-hook 'turn-on-auto-fill)
(add-hook 'LaTeX-mode-hook 'turn-on-auto-fill)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline39" class="outline-4">
<h4 id="orgheadline39"><span class="section-number-4">4.4.27</span> TRAMP</h4>
<div class="outline-text-4" id="text-4-4-27">
<p>
Use <i>TRAMP</i> (Transparent Remote Access, Multiple Protocols) to edit
remote files.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">tramp</span>
  <span style="color: #729fcf;">:config</span>
  (setq tramp-default-method <span style="color: #de7fa8;">"ssh"</span>
        tramp-persistency-file-name
        (expand-file-name <span style="color: #de7fa8;">"tramp"</span> my-tmp)))
</pre>
</div>

<p>
Expand region increases the selected region by semantic units.  I
included this package but never knew it before!!
</p>
</div>
</div>

<div id="outline-container-orgheadline40" class="outline-4">
<h4 id="orgheadline40"><span class="section-number-4">4.4.28</span> Undo-tree</h4>
<div class="outline-text-4" id="text-4-4-28">
<p>
Visualize the undo list in a tree-like structure for easy undo and
redo.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">undo-tree</span>
  <span style="color: #729fcf;">:init</span>
  (global-undo-tree-mode +1)
  <span style="color: #729fcf;">:bind</span> (<span style="color: #de7fa8;">"C-c u"</span> . undo-tree-visualize)
  <span style="color: #729fcf;">:diminish</span> undo-tree-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline41" class="outline-4">
<h4 id="orgheadline41"><span class="section-number-4">4.4.29</span> Uniquify</h4>
<div class="outline-text-4" id="text-4-4-29">
<p>
Distinguish buffers with the same name.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">uniquify</span>
  <span style="color: #729fcf;">:config</span>
  (setq uniquify-buffer-name-style 'forward
        uniquify-separator <span style="color: #de7fa8;">"/"</span>
        uniquify-after-kill-buffer-p t
        uniquify-ignore-buffers-re <span style="color: #de7fa8;">"^\\*"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline42" class="outline-4">
<h4 id="orgheadline42"><span class="section-number-4">4.4.30</span> Volatile-highlights</h4>
<div class="outline-text-4" id="text-4-4-30">
<p>
This package highlights changes just made to the buffer and the
highlights dispear at the next command.  It gives you a visual
feedback what is being changed.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">volatile-highlights</span>
  <span style="color: #729fcf;">:config</span>
  (volatile-highlights-mode t)
  <span style="color: #729fcf;">:diminish</span> volatile-highlights-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline43" class="outline-4">
<h4 id="orgheadline43"><span class="section-number-4">4.4.31</span> Writeroom-mode</h4>
<div class="outline-text-4" id="text-4-4-31">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">writeroom-mode</span>
  <span style="color: #729fcf;">:bind</span> (<span style="color: #de7fa8;">"C-c w"</span> . writeroom-mode)
  <span style="color: #729fcf;">:config</span> (setq writeroom-width (+ fill-column 10)))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline53" class="outline-2">
<h2 id="sec:editorsetting"><a id="orgheadline53"></a><span class="section-number-2">5</span> Editor Setting</h2>
<div class="outline-text-2" id="text-sec:editorsetting">
<p>
After the above preparations, we continue to customize the default
behaviours of our editor.  First and formost, I would like to avoid
accidentally closing Emacs.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq confirm-kill-emacs 'yes-or-no-p)
</pre>
</div>

<p>
Some wired erros might occur, sometimes I just want to see where
they actually originate from.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq debug-on-error t)
</pre>
</div>

<p>
Then load the theme package and enable <code>Hl-mode</code>.  The face has to be
set after loading the themes.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(load-theme 'naquadah t)
(global-hl-line-mode +1)
(set-face-background 'hl-line <span style="color: #de7fa8;">"#3B3D3A"</span>)
(set-face-foreground 'highlight nil)
</pre>
</div>
</div>

<div id="outline-container-orgheadline46" class="outline-3">
<h3 id="sec:encoding_font"><a id="orgheadline46"></a><span class="section-number-3">5.1</span> Encoding and Font</h3>
<div class="outline-text-3" id="text-sec:encoding_font">
<p>
First of all, it is the encoding system that matters.
</p>

<p>
I will stick to <code>utf-8</code> whenever possible.  In case of Chinese,
however, the default encoding under MS Windows is <code>cp936</code> (for
Simplified Chinese) and <code>cp950</code> (for Big5), <code>gb18030</code> and <code>gb2312</code> in
some cases.  I include them in the coding system in order to open
these files correctly.  And note that <code>prefer-coding-system</code> always
prefers the last preferred encoding, <code>utf-8</code> in the following code.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">let</span> ((my-prefer-coding-system
       '(cp950 gb2312 cp936 gb18030 utf-16 utf-8)))
  (<span style="color: #729fcf; font-weight: bold;">dolist</span> (c my-prefer-coding-system)
    (prefer-coding-system c)))
</pre>
</div>

<p>
Then comes the font for both English and Chinese.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(set-face-attribute 'default nil
                    <span style="color: #729fcf;">:family</span> <span style="color: #de7fa8;">"Ubuntu Mono"</span>
                    <span style="color: #729fcf;">:height</span> 120)

(<span style="color: #729fcf; font-weight: bold;">dolist</span> (charset '(kana han symbol cjk-misc bopomofo))
  (set-fontset-font
   (frame-parameter nil 'font)
   charset (font-spec <span style="color: #729fcf;">:family</span> <span style="color: #de7fa8;">"WenQuanYi Zen Hei Mono"</span>
                      <span style="color: #729fcf;">:size</span> 16)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline47" class="outline-3">
<h3 id="sec:default_behaviour"><a id="orgheadline47"></a><span class="section-number-3">5.2</span> Default Behaviours</h3>
<div class="outline-text-3" id="text-sec:default_behaviour">
<p>
Next is the tab thing.  Although I do not use <code>\t</code> for indentation, I
still set the <code>tab-width</code> in case I need it, e.g., Makefile.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq-default indent-tabs-mode nil)
(setq-default tab-width 8)
(setq-default tab-stop-list (number-sequence 2 120 2))
</pre>
</div>

<p>
Typing overwrites selected text.  Expected behaviour of most editors.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(delete-selection-mode t)
</pre>
</div>

<p>
Leaving double space after <code>.</code> makes it easier to delete a whole line
with <kbd>M-k</kbd>.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq colon-double-space t)
</pre>
</div>

<p>
Cleanup spaces and write timestamp if needed.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">my-cleanup-file</span> ()
  (delete-trailing-whitespace)
  (time-stamp))
(add-hook 'before-save-hook #'my-cleanup-file)

(setq tab-always-indent 'complete)
(blink-cursor-mode 0)
(setq scroll-preserve-screen-position t)
(setq require-final-newline t)
(mouse-avoidance-mode 'animate)
(setq blink-matching-paren nil)
</pre>
</div>

<p>
I do not need tool bar but I find menu bar helpful in case I forget
what operations are available in a major mode.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(tool-bar-mode 0)
(menu-bar-mode 1)
</pre>
</div>

<p>
I do not need the scroll bar either.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(scroll-bar-mode 0)
(setq scroll-margin 0
      scroll-preserve-screen-position 1)
</pre>
</div>

<p>
Turn on <code>subword-mode</code> so that <kbd>C-right</kbd> moves in step of a
subword.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(global-subword-mode 1)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq frame-title-format
      '(<span style="color: #de7fa8;">"emacs%@"</span>
        (<span style="color: #729fcf;">:eval</span> (system-name)) <span style="color: #de7fa8;">": "</span>
        (<span style="color: #729fcf;">:eval</span>
         (<span style="color: #729fcf; font-weight: bold;">if</span> (buffer-file-name) (abbreviate-file-name (buffer-file-name))
           <span style="color: #de7fa8;">"%b"</span>)) <span style="color: #de7fa8;">" [%*]"</span>))

(setq visible-bell t)

(setq inhibit-startup-message t
      resize-mini-windows t)

(column-number-mode 1)
(setq size-indication-mode t)

(fset 'yes-or-no-p 'y-or-n-p)

(file-name-shadow-mode t)

(put 'narrow-to-region 'disabled nil)
(put 'narrow-to-page 'disabled nil)
(put 'narrow-to-defun 'disabled nil)
(put 'upcase-region 'disabled nil)
(put 'downcase-region 'disabled nil)
</pre>
</div>

<p>
Many of the settings above are rather self-evident.  The following
<i>advice</i> is for <kbd>M-w</kbd>, copy command in Emacs.  By default,
<kbd>M-w</kbd> operates on a selected region and does nothing when no
text is selected.  Instead of doing nothing, we <i>advice</i> it to copy
current line. i.e., where cursor resides, when no region is active.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">defadvice</span> <span style="color: #fcaf3e; font-weight: bold;">kill-ring-save</span>
    (before slick-copy activate compile)
  <span style="color: #babdb6; font-style: italic;">"When called interactively with no active region, copy a single</span>
<span style="color: #babdb6; font-style: italic;">         line instead."</span>
  (interactive
   (<span style="color: #729fcf; font-weight: bold;">if</span> mark-active
       (list (region-beginning)
             (region-end))
     (message <span style="color: #de7fa8;">"Copied line"</span>)
     (list (line-beginning-position)
           (line-beginning-position 2)))))
</pre>
</div>

<p>
Backup files in the temp directory instead of clustering everywhere
with tild-ended files.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq backup-directory-alist `((<span style="color: #de7fa8;">".*"</span> . ,my-tmp)))
(setq auto-save-list-file-prefix
      (expand-file-name <span style="color: #de7fa8;">".saves-"</span> my-tmp))

(setq backup-by-copying t
      delete-old-versions t
      kept-new-versions 6
      kept-old-versions 2
      version-control t)
</pre>
</div>

<p>
Open read-only files in <code>view-mode</code> minor mode.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq view-read-only t)
</pre>
</div>

<p>
I do not show line numbers at the margin as I do not care.  But I do
care when I want to jump to a certain line in the buffer.  So show me
the line numbers only when I'm about to jump to a line.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">goto-line-with-feedback</span> ()
  <span style="color: #babdb6; font-style: italic;">"Show line numbers temporarily, while prompting for the line</span>
<span style="color: #babdb6; font-style: italic;">         number input"</span>
  (interactive)
  (<span style="color: #729fcf; font-weight: bold;">unwind-protect</span>
      (<span style="color: #729fcf; font-weight: bold;">progn</span>
        (linum-mode 1)
        (goto-line (read-number <span style="color: #de7fa8;">"Goto line: "</span>)))
    (linum-mode -1)))

(global-set-key [remap goto-line] 'goto-line-with-feedback)
</pre>
</div>

<p>
Turn on <code>auto-fill-mode</code> by default.  For <i>historical</i> (unknown)
reasons, <code>auto-fill-mode</code> is named by "auto-fill-function".
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">if</span> (display-graphic-p)
    (diminish #'auto-fill-function (concat <span style="color: #de7fa8;">" "</span> [#xF036]))
  (diminish #'auto-fill-function))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline52" class="outline-3">
<h3 id="sec:key"><a id="orgheadline52"></a><span class="section-number-3">5.3</span> Key bindings</h3>
<div class="outline-text-3" id="text-sec:key">
</div>

<div id="outline-container-orgheadline48" class="outline-4">
<h4 id="orgheadline48"><span class="section-number-4">5.3.1</span> Function Key Bindings</h4>
<div class="outline-text-4" id="text-5-3-1">
<p>
Keybindings for <kbd>Fn</kbd> keys.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #de7fa8;">"&lt;f6&gt;"</span>) #'calendar)
(global-set-key (kbd <span style="color: #de7fa8;">"&lt;f7&gt;"</span>) #'compile)
(global-set-key (kbd <span style="color: #de7fa8;">"&lt;f8&gt;"</span>) #'deft)
(global-set-key (kbd <span style="color: #de7fa8;">"&lt;f9&gt;"</span>) #'helm-recentf)
<span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">f10 -- menu</span>
(global-set-key (kbd <span style="color: #de7fa8;">"&lt;f11&gt;"</span>) 'ispell)
<span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">f12 -- gnus-other-frame)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline49" class="outline-4">
<h4 id="orgheadline49"><span class="section-number-4">5.3.2</span> Improved Standard Bindings</h4>
<div class="outline-text-4" id="text-5-3-2">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(global-set-key [remap execute-extended-command] #'helm-M-x)
(global-set-key [remap switch-to-buffer] #'helm-mini)
(global-set-key [remap find-file] #'helm-find-files)
(global-set-key [remap list-buffers] #'ibuffer)
(global-set-key [remap isearch-forward] #'isearch-forward-regexp)
(global-set-key [remap isearch-backward] #'isearch-query-replace-regexp)
(global-set-key [remap yank-pop] #'helm-show-kill-ring)
(global-set-key (kbd <span style="color: #de7fa8;">"C-z"</span>) #'delete-other-windows)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline50" class="outline-4">
<h4 id="orgheadline50"><span class="section-number-4">5.3.3</span> User Key Bindings</h4>
<div class="outline-text-4" id="text-5-3-3">
<p>
User key bindings usually begin with <kbd>C-c</kbd>.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">C-c a -- my-ag-map</span>
<span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">C-c d -- drag-stuff-mode</span>

(<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">clear-shell</span> ()
  <span style="color: #babdb6; font-style: italic;">"Clear shell window."</span>
   (interactive)
   (<span style="color: #729fcf; font-weight: bold;">let</span> ((old-max comint-buffer-maximum-size))
     (setq comint-buffer-maximum-size 0)
     (comint-truncate-buffer)
     (setq comint-buffer-maximum-size old-max)))

(global-set-key (kbd <span style="color: #de7fa8;">"C-c c"</span>) #'clear-shell)
<span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">C-c f -- flycheck-mode</span>
(global-set-key (kbd <span style="color: #de7fa8;">"C-c g"</span>) #'ace-jump-mode)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c m"</span>) #'magit-status)
<span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">C-c M -- my-multiple-cursor-map</span>
(global-set-key (kbd <span style="color: #de7fa8;">"C-c q"</span>) #'auto-fill-mode)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c r"</span>) #'isearch-query-replace-regexp)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c o a"</span>) #'org-agenda)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c o c"</span>) #'org-capture)
<span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">C-c w -- writeroom-mode</span>
(global-set-key (kbd <span style="color: #de7fa8;">"C-c ,"</span>) #'color-identifiers-mode)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c ("</span>) #'rainbow-delimiters-mode)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c C-="</span>) #'align-regexp)

(global-set-key (kbd <span style="color: #de7fa8;">"C-c &lt;left&gt;"</span>) #'decrease-left-margin)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c &lt;right&gt;"</span>) #'increase-left-margin)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c C-&lt;left&gt;"</span>) #'decrease-left-margin)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c C-&lt;right&gt;"</span>) #'increase-left-margin)
</pre>
</div>

<p>
Since most of the time <kbd>C-c C-c</kbd> is unavailable, and
<kbd>C-c \</kbd> is used in Org mode, I have to choose
<kbd>C-x</kbd> prefix.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">my-comment-or-uncomment-region</span> ()
  <span style="color: #babdb6; font-style: italic;">"Comment a region or a line if no region is marked."</span>
  (interactive)
  (my-apply-region-or-line #'comment-or-uncomment-region))
(global-set-key (kbd <span style="color: #de7fa8;">"C-x \\"</span>) #'my-comment-or-uncomment-region)
(global-set-key (kbd <span style="color: #de7fa8;">"C-x C-\\"</span>) #'my-comment-or-uncomment-region)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline51" class="outline-4">
<h4 id="orgheadline51"><span class="section-number-4">5.3.4</span> Key logger</h4>
<div class="outline-text-4" id="text-5-3-4">
<p>
Sometimes I want to analyze my Emacs key press frequency.  The
builtin function <code>open-dribble-file</code> does exactly what I want.  But
be aware that it logs <i>everything</i>, literally, <i>everything</i>
including your passwords.  So you may remove this section from your
configuration files.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">when</span> (display-graphic-p)

  (open-dribble-file
   (expand-file-name
    (format-time-string <span style="color: #de7fa8;">"~/.emacs.d/keylog/key-%FT%H%M%S.log"</span>)))

  (<span style="color: #729fcf; font-weight: bold;">cl-defun</span> <span style="color: #fcaf3e; font-weight: bold;">my-sync-keylog</span>
      (<span style="color: #fce94f; font-weight: bold;">&amp;optional</span>
       (source (expand-file-name <span style="color: #de7fa8;">"~/.emacs.d/keylog/"</span>))
       (target (expand-file-name <span style="color: #de7fa8;">"~/Dropbox/dotfiles/emacs.d/keylog"</span>)))
    (async-shell-command (format <span style="color: #de7fa8;">"rsync -rp %s %s"</span> source target)))

  (add-hook 'kill-emacs-hook #'my-sync-keylog))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline2" class="outline-2">
<h2 id="orgheadline2"><span class="section-number-2">6</span> End</h2>
<div class="outline-text-2" id="text-6">
<p>
After all these things, start the server.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-hook 'after-init-hook 'server-start t)
</pre>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
As a side note, I guess his blog style might be adopted from
<a href="http://doc.norang.ca/">Bernt Hansen</a> blog site.  Correct me if I'm wrong.
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
See <a href="https://cask.readthedocs.org/en/latest/guide/introduction.html">Why Cask?</a>.
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<a class="author"
           href="http://gongzhitaao.org">Zhitao Gong</a> / <span
           class="date">2015-12-02 Wed 17:48</span><span class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.5.1 (<a href="http://orgmode.org">Org</a> mode 8.3.2)</span>
</div>
</body>
</html>
