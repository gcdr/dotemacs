<!DOCTYPE html>
<html>
<head>
<title>Emacs Configurations</title>
<!-- 2015-07-28 Tue 15:16 -->
<meta  charset="utf-8">
<meta  name="generator" content="Org-mode">
<meta  name="author" content="Zhitao Gong">
<meta name="description" content="Emacs configurations written in Orgmode.">
<meta name="keywords" content="emacs,orgmode,literal programming,emacs-lisp,org">
<link rel="stylesheet" href="normalize.css" type="text/css" />
<link rel="stylesheet" href="https://gongzhitaao.github.io/orgcss/org.css" type="text/css" />
</head>
<body>
<div id="content">
<h1 class="title">Emacs Configurations</h1>
<hr >

<a href="https://github.com/gongzhitaao/dotemacs"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

<div class="abstract">
<p>
However I organize my Emacs configurations, they all seem a mess to me
after a while.
</p>

</div>

<nav id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec:introduction">1. Introduction</a></li>
<li><a href="#sec:bootstrap">2. Bootstrap</a></li>
<li><a href="#sec:pacman">3. Package Manager</a>
<ul>
<li><a href="#sec-3-1">3.1. <i>Deprecated</i> Manager</a></li>
<li><a href="#sec-3-2">3.2. Preferred Way</a></li>
</ul>
</li>
<li><a href="#sec:helper">4. Helper Variables and Functions</a></li>
<li><a href="#sec:packmode">5. Packages and Modes</a>
<ul>
<li><a href="#sec:gnus">5.1. Gnus</a></li>
<li><a href="#sec:orgmode">5.2. Orgmode</a></li>
<li><a href="#sec-5-3">5.3. Helm</a></li>
<li><a href="#sec:miscpac">5.4. Miscellaneous Packages</a></li>
</ul>
</li>
<li><a href="#sec:editorsetting">6. Editor Setting</a>
<ul>
<li><a href="#sec:encoding_font">6.1. Encoding and Font</a></li>
<li><a href="#sec:default_behaviour">6.2. Default Behaviours</a></li>
<li><a href="#sec:key">6.3. Key bindings</a></li>
</ul>
</li>
<li><a href="#sec-7">7. End</a></li>
</ul>
</div>
</nav>

<div id="outline-container-sec:introduction" class="outline-2">
<h2 id="sec:introduction"><a id="sec-1" name="sec-1"></a><span class="section-number-2">1</span> Introduction</h2>
<div class="outline-text-2" id="text-sec:introduction">

<p>
This is my Emacs configuration, stored in <code>conf.org</code> file with all
these texts and loaded by <code>org-babel-load-file</code> from <code>init.el</code>.  This
is inspired by <a href="http://writequit.org/">Matthew Lee Hinman</a><sup><a id="fnr.1" name="fnr.1" class="footref" href="#fn.1">1</a></sup> in his <a href="http://writequit.org/org/settings.html">settings</a>.  This project
is hosted with â™¥ by Github, here is the <a href="https://github.com/gongzhitaao/dotemacs">repo</a>.
</p>

<p>
This file is last updated 2015-07-28 15:16.
</p>
</div>
</div>

<div id="outline-container-sec:bootstrap" class="outline-2">
<h2 id="sec:bootstrap"><a id="sec-2" name="sec-2"></a><span class="section-number-2">2</span> Bootstrap</h2>
<div class="outline-text-2" id="text-sec:bootstrap">

<p>
I use <code>emacs.d/init.el</code> to bootstrap all my Emacs configurations.  The
only thing done in <code>init.el</code> is to load this file, <code>conf.org</code>, which
includes all our documented configurations.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">require</span> '<span style="color: #73d216;">org</span>)
(org-babel-load-file <span style="color: #de7fa8;">"~/.emacs.d/conf.org"</span>)
</pre>
</div>

<p>
The following sections are all the documented configurations.
</p>
</div>
</div>

<div id="outline-container-sec:pacman" class="outline-2">
<h2 id="sec:pacman"><a id="sec-3" name="sec-3"></a><span class="section-number-2">3</span> Package Manager</h2>
<div class="outline-text-2" id="text-sec:pacman">

<p>
Before any loading and configuration, I need to make sure all my
utility packages are installed.
</p>
</div>

<div id="outline-container-sec-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> <i>Deprecated</i> Manager</h3>
<div class="outline-text-3" id="text-3-1">
<p>
This is how I did, and probably what you are doing.
</p>

<ol class="org-ol">
<li>First of all, maintain a list of packages.

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">defvar</span> <span style="color: #ff2929;">my/package-list</span>
  '(

    <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">A super long list of all packages</span>

    ))
</pre>
</div>
</li>

<li>Then add official archives and initialize the package system.

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">require</span> '<span style="color: #73d216;">package</span>)
(setq package-archives
      '((<span style="color: #de7fa8;">"gnu"</span> . <span style="color: #de7fa8;">"http://elpa.gnu.org/packages/"</span>)
        (<span style="color: #de7fa8;">"marmalade"</span> . <span style="color: #de7fa8;">"http://marmalade-repo.org/packages/"</span>)
        (<span style="color: #de7fa8;">"melpa"</span> . <span style="color: #de7fa8;">"http://melpa.org/packages/"</span>)
        (<span style="color: #de7fa8;">"org"</span> . <span style="color: #de7fa8;">"http://orgmode.org/elpa/"</span>)))
(package-initialize)

(or (file-exists-p package-user-dir) (package-refresh-contents))
</pre>
</div>
</li>

<li>And finally install, if neccessary all the packages.

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">dolist</span> (pack my/package-list)
  (<span style="color: #729fcf; font-weight: bold;">unless</span> (package-installed-p pack)
    (package-install pack)))
</pre>
</div>
</li>
</ol>


<p>
It works.  But there is one thing I particularly do not like about
the default packaging system: when updating packages, it
<i>re-downloads</i> all the outdated package instead of retrieving only
modified files like <code>git pull</code>.  It takes quite a while to uncompress
and compile large packages, e.g., <code>ess</code> (Emacs Speaks Statistics),
<code>org</code>, <code>org-plus-contrib</code> and etc.  And Emacs is blocked during this
process since it is <i>single-threaded</i>!
</p>
</div>
</div>

<div id="outline-container-sec-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Preferred Way</h3>
<div class="outline-text-3" id="text-3-2">
<p>
Just found about <a href="http://cask.readthedocs.org/en/latest/index.html">Cask</a>, yet another package manager for Emacs.  See
<a href="https://cask.readthedocs.org/en/latest/guide/introduction.html">Why Cask?</a> for the reason of switching to Cask.  All dependencies are
stored in <code>Cask</code> under <code>.emacs.d/</code>.
</p>

<p>
The contents of Cask is as follows (long list of packages are omitted
for brevity).
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(source gnu)
(source melpa)
(source marmalade)
(source org)

(depends-on <span style="color: #de7fa8;">"ace-jump-mode"</span>)
(depends-on <span style="color: #de7fa8;">"ag"</span>)
(depends-on <span style="color: #de7fa8;">"anzu"</span>)
(depends-on <span style="color: #de7fa8;">"async"</span>)
(depends-on <span style="color: #de7fa8;">"auctex"</span>)
<span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">the (depends-on ...) list goes on and on</span>
</pre>
</div>

<p>
And the following snippet is needed to initialize the <code>cask</code> manager.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">require</span> '<span style="color: #73d216;">cask</span> <span style="color: #de7fa8;">"~/.cask/cask.el"</span>)
(cask-initialize)
(<span style="color: #729fcf; font-weight: bold;">require</span> '<span style="color: #73d216;">pallet</span>)
(pallet-mode t)
</pre>
</div>

<p>
For more information about Cask, please refer to its
<a href="http://cask.readthedocs.org/en/latest/">documentation</a>.
</p>

<p>
And as usual, load <code>use-package</code> first which is used for loading
packages everywhere else.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">require</span> '<span style="color: #73d216;">use-package</span>)
</pre>
</div>

<p>
Disable debugging information for package loading.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq use-package-verbose nil)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec:helper" class="outline-2">
<h2 id="sec:helper"><a id="sec-4" name="sec-4"></a><span class="section-number-2">4</span> Helper Variables and Functions</h2>
<div class="outline-text-2" id="text-sec:helper">

<p>
Now start with some useful variables and function.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq user-full-name <span style="color: #de7fa8;">"Zhitao Gong"</span>)
(setq user-mail-address <span style="color: #de7fa8;">"me@gongzhitaao.org"</span>)

(<span style="color: #729fcf; font-weight: bold;">defvar</span> <span style="color: #ff2929;">my-dir</span> user-emacs-directory
  <span style="color: #babdb6; font-style: italic;">"The root dir for my Emacs configuration."</span>)
(<span style="color: #729fcf; font-weight: bold;">defvar</span> <span style="color: #ff2929;">my-tmp</span> (expand-file-name <span style="color: #de7fa8;">"tmp"</span> my-dir)
  <span style="color: #babdb6; font-style: italic;">"Temp files that might be useful but that I don't care about."</span>)
(<span style="color: #729fcf; font-weight: bold;">defvar</span> <span style="color: #ff2929;">my-personal-dir</span> (expand-file-name <span style="color: #de7fa8;">"~/Dropbox/emacs/personal"</span>))
(<span style="color: #729fcf; font-weight: bold;">defvar</span> <span style="color: #ff2929;">my-icons-dir</span> (expand-file-name <span style="color: #de7fa8;">"icons"</span> my-dir)
  <span style="color: #babdb6; font-style: italic;">"Where All the icons are stored."</span>)

(<span style="color: #729fcf; font-weight: bold;">unless</span> (file-exists-p my-tmp) (make-directory my-tmp))
</pre>
</div>

<p>
Then follows some helper functions.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">my-apply-region-or-line</span> (func)
  <span style="color: #babdb6; font-style: italic;">"Apply FUNC to a region, or current line if mark is not</span>
<span style="color: #babdb6; font-style: italic;">      active."</span>
  (<span style="color: #729fcf; font-weight: bold;">save-excursion</span>
    (<span style="color: #729fcf; font-weight: bold;">if</span> (region-active-p)
        (funcall func (region-beginning) (region-end))
      (funcall func (line-beginning-position) (line-end-position)))))

(<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">my-apply-region-or-para</span> (func)
  <span style="color: #babdb6; font-style: italic;">"Apply FUNC to a region, or current paragraph if mark is not active."</span>
  (<span style="color: #729fcf; font-weight: bold;">save-excursion</span>
    (<span style="color: #729fcf; font-weight: bold;">if</span> (not (region-active-p))
        (mark-paragraph))
    (funcall func (region-beginning) (region-end))))

(<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">sort-words</span> (reverse beg end)
  <span style="color: #babdb6; font-style: italic;">"Sort words in region alphabetically, in REVERSE if</span>
<span style="color: #babdb6; font-style: italic;">      negative. Prefixed with negative \\[</span><span style="color: #73d216; font-style: italic;">universal-argument</span><span style="color: #babdb6; font-style: italic;">], sorts</span>
<span style="color: #babdb6; font-style: italic;">      in reverse.</span>

<span style="color: #babdb6; font-style: italic;">        The variable `</span><span style="color: #73d216; font-style: italic;">sort-fold-case</span><span style="color: #babdb6; font-style: italic;">' determines whether alphabetic</span>
<span style="color: #babdb6; font-style: italic;">        case affects the sort order.</span>

<span style="color: #babdb6; font-style: italic;">        See `</span><span style="color: #73d216; font-style: italic;">sort-regexp-fields</span><span style="color: #babdb6; font-style: italic;">'."</span>
  (interactive <span style="color: #de7fa8;">"*P\nr"</span>)
  (sort-regexp-fields reverse <span style="color: #de7fa8;">"</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">(</span><span style="color: #de7fa8;">\\w</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">|</span><span style="color: #de7fa8;">-</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">)</span><span style="color: #de7fa8;">+"</span> <span style="color: #de7fa8;">"\\&amp;"</span> beg end))

(<span style="color: #729fcf; font-weight: bold;">defmacro</span> <span style="color: #fcaf3e; font-weight: bold;">rename-modeline</span> (package-name mode new-name)
  <span style="color: #babdb6; font-style: italic;">"Rename modeline."</span>
  `(eval-after-load ,package-name
     '(<span style="color: #729fcf; font-weight: bold;">defadvice</span> ,mode (after rename-modeline activate)
        (setq mode-name ,new-name))))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec:packmode" class="outline-2">
<h2 id="sec:packmode"><a id="sec-5" name="sec-5"></a><span class="section-number-2">5</span> Packages and Modes</h2>
<div class="outline-text-2" id="text-sec:packmode">

<p>
This section contains goodies that enpower Emacs.  Two of the most
important packages I'm using, Orgmode and Gnus are kept in separate
configuration files and listed in separeted sections, while all others
are all listed under Section <a href="#sec:miscpac">5.4</a>.
</p>
</div>

<div id="outline-container-sec:gnus" class="outline-3">
<h3 id="sec:gnus"><a id="sec-5-1" name="sec-5-1"></a><span class="section-number-3">5.1</span> Gnus</h3>
<div class="outline-text-3" id="text-sec:gnus">

<blockquote>
<p>
Gnus is a flexible message reader running under GNU Emacs.  It
supports reading and composing both news and mail.  In addition, it
is able to use a number of web-based sources as inputs for its
groups.
</p>
</blockquote>

<p>
I choose Gnus over other GUI or console email client mainly because
it is a builtin Emacs package, which gives me access to most of the
powerful goodies when composing and reading emails.
</p>

<p>
With all that being said, it has a rather steep learning curve, three
years for me.  However, as a heavy Emacs user, it worth the effort.
</p>
</div>

<div id="outline-container-sec-5-1-1" class="outline-4">
<h4 id="sec-5-1-1"><span class="section-number-4">5.1.1</span> Tool chain</h4>
<div class="outline-text-4" id="text-5-1-1">
<p>
Gnus can be used to handle all the process of mail, i.e., fetching
mails from server as well as local mail pool, reading mails and
performing various operations on mails and send mails.  However, I
prefer to deligate fetching and serving mails to delicate programs,
<a href="http://offlineimap.org/">offlineimap</a> for fetching and updating mails and <a href="http://www.dovecot.org/">dovecot</a> for serving
mails.
</p>

<p>
Since coordinating and properly configuring the three programs,
<i>dovecot</i>, <i>offlineimap</i> and <i>Gnus</i>, seems a little intricate at the
beginning, I include all the settings to make the puzzle more
complete.
</p>

<p>
The whole workflow of this tool chain is as follows.
</p>

<ol class="org-ol">
<li>Offlineimap periodically updates mails in <code>Mail</code> folder,
</li>
<li>Dovecot, the mail server, serves mail requests at local port (143
for <i>imap</i> and 993 for <i>imaps</i>), and
</li>
<li>Gnus connects to the local ports, being listened by Dovecot.
</li>
</ol>
</div>
</div>

<div id="outline-container-sec-5-1-2" class="outline-4">
<h4 id="sec-5-1-2"><span class="section-number-4">5.1.2</span> Configuration</h4>
<div class="outline-text-4" id="text-5-1-2">
<p>
All configurations to make Gnus work are included in this section.
I would assume that all these programs have been correctly
installed.
</p>
</div>

<div id="outline-container-sec-5-1-2-1" class="outline-5">
<h5 id="sec-5-1-2-1">Dovecot</h5>
<div class="outline-text-5" id="text-5-1-2-1">
<p>
This configuration is relatively simple.  Edit
<code>DOVECOT_DIR/conf.d/10-mail.conf</code>, change the <code>mail_location</code>
</p>

<div class="org-src-container">

<pre class="src src-conf"><span style="color: #babdb6; font-style: italic;">#</span><span style="color: #babdb6; font-style: italic;">mail_location = mbox:~/mail:INBOX=/var/mail/%u</span>
<span style="color: #ff2929;">mail_location</span> = maildir:~/Mail:LAYOUT=fs
</pre>
</div>

<p>
By default Dovecot uses Maildir++ directory layout which means that
all mailboxes are stored in a single directory and prefixed with a
dot.  But offlineimap by default works with <code>/</code> (forward slash),
i.e., conventional hierarchical directories.  <code>LAYOUT\=fs</code> tells
Dovecot to use hierarchical directories.
</p>
</div>
</div>

<div id="outline-container-sec-5-1-2-2" class="outline-5">
<h5 id="sec-5-1-2-2">Offlineimap</h5>
<div class="outline-text-5" id="text-5-1-2-2">
<p>
Offlineimap reads configuration from <code>~/.offlineimaprc</code>.  You can
find a complete configuration sample, <code>offlineimap.conf</code>, shipped
with installation.
</p>

<p>
One thing to note is that Offlineimap <i>DOES NOT invoke itself</i>.  In
order to periodically update mails, we need to either manually
execute it or use other programs.  I use <i>cron</i> utility to invoke
Offlineimap every 5 minutes, as show in the following code.
</p>

<div class="org-src-container">

<pre class="src src-conf">*/5 * * * * /usr/bin/offlineimap
</pre>
</div>

<p>
My Offlineimap configuration is as follows.
</p>

<div class="org-src-container">

<pre class="src src-conf">[<span style="color: #fce94f; font-weight: bold;">general</span>]

<span style="color: #ff2929;">accounts</span> = Tiger, Gmail, Ymail
<span style="color: #ff2929;">maxsyncaccounts</span> = 4

[<span style="color: #fce94f; font-weight: bold;">Account Tiger</span>]

<span style="color: #ff2929;">localrepository</span> = TigerLocal
<span style="color: #ff2929;">remoterepository</span> = TigerRemote

[<span style="color: #fce94f; font-weight: bold;">Repository TigerLocal</span>]

<span style="color: #ff2929;">type</span> = Maildir
<span style="color: #ff2929;">localfolders</span> = ~/Mail/Tiger
<span style="color: #ff2929;">sep</span> = /

[<span style="color: #fce94f; font-weight: bold;">Repository TigerRemote</span>]

<span style="color: #ff2929;">type</span> = IMAP
<span style="color: #ff2929;">remotehost</span> = outlook.office365.com

<span style="color: #ff2929;">ssl</span> = yes
<span style="color: #ff2929;">sslcacertfile</span> = /etc/ssl/certs/ca-certificates.crt

<span style="color: #ff2929;">remoteport</span> = 993
<span style="color: #ff2929;">remoteuser</span> = my_livemail_address
<span style="color: #ff2929;">createfolders</span> = False

[<span style="color: #fce94f; font-weight: bold;">Account Gmail</span>]

<span style="color: #ff2929;">localrepository</span> = GmailLocal
<span style="color: #ff2929;">remoterepository</span> = GmailRemote

[<span style="color: #fce94f; font-weight: bold;">Repository GmailLocal</span>]

<span style="color: #ff2929;">type</span> = Maildir
<span style="color: #ff2929;">localfolders</span> = ~/Mail/Gmail sep = /

[<span style="color: #fce94f; font-weight: bold;">Repository GmailRemote</span>]

<span style="color: #ff2929;">type</span> = Gmail
<span style="color: #ff2929;">remoteuser</span> = my_gmail_address
<span style="color: #ff2929;">sslcacertfile</span> = /etc/ssl/certs/ca-certificates.crt

[<span style="color: #fce94f; font-weight: bold;">Account Ymail</span>]

<span style="color: #ff2929;">localrepository</span> = YmailLocal
<span style="color: #ff2929;">remoterepository</span> = YmailRemote

[<span style="color: #fce94f; font-weight: bold;">Repository YmailLocal</span>]

<span style="color: #ff2929;">type</span> = Maildir
<span style="color: #ff2929;">localfolders</span> = ~/Mail/Ymail
<span style="color: #ff2929;">sep</span> = /

[<span style="color: #fce94f; font-weight: bold;">Repository YmailRemote</span>]

<span style="color: #ff2929;">type</span> = IMAP
<span style="color: #ff2929;">remotehost</span> = imap.mail.yahoo.com

<span style="color: #ff2929;">ssl</span> = yes
<span style="color: #ff2929;">sslcacertfile</span> = /etc/ssl/certs/ca-certificates.crt

<span style="color: #ff2929;">remoteport</span> = 993
<span style="color: #ff2929;">remoteuser</span> = my_ymail_address
<span style="color: #ff2929;">createfolders</span> = False
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-1-2-3" class="outline-5">
<h5 id="sec-5-1-2-3">Gnus</h5>
<div class="outline-text-5" id="text-5-1-2-3">
<p>
Now comes the workhorse, <i>Gnus</i>.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">gnus</span>
  <span style="color: #729fcf;">:bind</span> (<span style="color: #de7fa8;">"&lt;f12&gt;"</span> . gnus-other-frame)
  <span style="color: #729fcf;">:config</span>
  (setq gnus-init-file <span style="color: #de7fa8;">"/home/gongzhitaao/.emacs.d/gnus-conf.el"</span>))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec:orgmode" class="outline-3">
<h3 id="sec:orgmode"><a id="sec-5-2" name="sec-5-2"></a><span class="section-number-3">5.2</span> Orgmode</h3>
<div class="outline-text-3" id="text-sec:orgmode">

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">org</span>
  <span style="color: #729fcf;">:if</span> (display-graphic-p)
  <span style="color: #729fcf;">:config</span>
  (<span style="color: #729fcf; font-weight: bold;">let</span> ((my-org-modules
         '(org-bbdb
           org-bibtex
           org-clock
           org-docview
           org-gnus
           org-habit
           org-table
           ox-latex
           ox-bibtex)))
    (<span style="color: #729fcf; font-weight: bold;">dolist</span> (m my-org-modules)
      (<span style="color: #729fcf; font-weight: bold;">require</span> <span style="color: #73d216;">m</span>)))

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Where I add todos.</span>
  (add-hook 'org-mode-hook 'turn-on-reftex)
  (add-hook 'org-mode-hook 'turn-on-auto-fill)

  (<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">org-ref</span>
    <span style="color: #729fcf;">:load-path</span> (<span style="color: #729fcf; font-weight: bold;">lambda</span> () (expand-file-name <span style="color: #de7fa8;">"org-ref"</span> my-dir))
    <span style="color: #729fcf;">:config</span>
    (<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">doi-utils</span>)
    (<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">jmax-bibtex</span>)
    (<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">pubmed</span>)
    (<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">arxiv</span>)
    (<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">sci-id</span>)

    (setq org-ref-bibliography-notes
          '(<span style="color: #de7fa8;">"~/Dropbox/bibliography/notes.org.gz"</span>)
          org-ref-default-bibliography
          '(<span style="color: #de7fa8;">"~/Dropbox/bibliography/index.bib.gz"</span>)
          org-ref-pdf-directory
          '(<span style="color: #de7fa8;">"~/Dropbox/bibliography/pdfs/"</span>)))

  (define-key org-mode-map (kbd <span style="color: #de7fa8;">"C-c )"</span>) #'reftex-reference)
  (define-key org-mode-map (kbd <span style="color: #de7fa8;">"C-c ["</span>) #'reftex-citation)
  (define-key org-mode-map [remap fill-paragraph] #'org-fill-paragraph)
  (define-key org-mode-map (kbd <span style="color: #de7fa8;">"C-c C-\\"</span>)
    (<span style="color: #729fcf; font-weight: bold;">lambda</span> ()
      (interactive)
      (my-apply-region-or-para 'org-indent-region)))

  (setq org-directory (expand-file-name <span style="color: #de7fa8;">"org"</span> my-personal-dir))

  (setq org-time-stamp-custom-formats
        '(<span style="color: #de7fa8;">"&lt;%m/%d/%y %a&gt;"</span> . <span style="color: #de7fa8;">"&lt;%Y-%m-%d %a %R %z&gt;"</span>))

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Recursive update todo statistics</span>
  (setq org-hierarchical-todo-statistics nil)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Show events from diary</span>
  (setq org-agenda-include-diary t)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Resolve open clocks if the user if idle more than 10 minutes.</span>
  (setq org-clock-idle-time 10)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Sublevels inherit property from parents</span>
  (setq org-use-property-inheritance t)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Fontify src blocks</span>
  (setq org-src-fontify-natively t)
  (setq org-src-preserve-indentation t)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Press enter to follow links</span>
  (setq org-return-follows-link t)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Use html5 and DO NOT include default styles and scripts.</span>
  (setq org-html-doctype <span style="color: #de7fa8;">"html5"</span>
        org-html-html5-fancy t
        org-html-head-include-default-style nil
        org-html-head-include-scripts nil)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Postamble.</span>
  (setq org-html-postamble t org-html-postamble-format
        '((<span style="color: #de7fa8;">"en"</span> <span style="color: #de7fa8;">"&lt;a class=\"author\"</span>
<span style="color: #de7fa8;">       href=\"http://gongzhitaao.org\"&gt;%a&lt;/a&gt; / &lt;span</span>
<span style="color: #de7fa8;">       class=\"date\"&gt;%T&lt;/span&gt;&lt;span class=\"creator\"&gt;%c&lt;/span&gt;"</span>)))

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Use prefix key as tag selection</span>
  (setq org-use-fast-todo-selection t)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Bypassing logging if change state with Shift key</span>
  (setq org-treat-S-cursor-todo-selection-as-state-change nil)

  (setq org-todo-keywords
        '((sequence
           <span style="color: #de7fa8;">"TODO(t)"</span> <span style="color: #de7fa8;">"NEXT(n)"</span> <span style="color: #de7fa8;">"|"</span>
           <span style="color: #de7fa8;">"DONE(d!)"</span>)
          (sequence
           <span style="color: #de7fa8;">"WAIT(w@/!)"</span> <span style="color: #de7fa8;">"HOLD(h@/!)"</span> <span style="color: #de7fa8;">"|"</span>
           <span style="color: #de7fa8;">"KILL(k@)"</span>)))

  (setq org-todo-keyword-faces
        '((<span style="color: #de7fa8;">"TODO"</span> <span style="color: #729fcf;">:foreground</span> <span style="color: #de7fa8;">"red"</span> <span style="color: #729fcf;">:weight</span> bold)
          (<span style="color: #de7fa8;">"NEXT"</span> <span style="color: #729fcf;">:foreground</span> <span style="color: #de7fa8;">"cyan"</span> <span style="color: #729fcf;">:weight</span> bold)
          (<span style="color: #de7fa8;">"DONE"</span> <span style="color: #729fcf;">:foreground</span> <span style="color: #de7fa8;">"green"</span> <span style="color: #729fcf;">:weight</span> bold)
          (<span style="color: #de7fa8;">"WAIT"</span> <span style="color: #729fcf;">:foreground</span> <span style="color: #de7fa8;">"yellow"</span> <span style="color: #729fcf;">:weight</span> bold)
          (<span style="color: #de7fa8;">"HOLD"</span> <span style="color: #729fcf;">:foreground</span> <span style="color: #de7fa8;">"magenta"</span> <span style="color: #729fcf;">:weight</span> bold)
          (<span style="color: #de7fa8;">"KILL"</span> <span style="color: #729fcf;">:foreground</span> <span style="color: #de7fa8;">"forest green"</span> <span style="color: #729fcf;">:weight</span> bold)))

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Files to be included in Agenda view.</span>
  (setq org-agenda-files
        (expand-file-name <span style="color: #de7fa8;">"orgfile"</span> org-directory))


  (setq org-agenda-dim-blocked-tasks t)
  (setq org-agenda-compact-blocks t)

  (setq org-agenda-repeating-timestamp-show-all t)
  (setq org-agenda-show-all-dates t)

  (setq org-agenda-prefix-format
        '((agenda . <span style="color: #de7fa8;">" %i %-12:c%?-12t% s"</span>)
          (timeline . <span style="color: #de7fa8;">"  % s"</span>)
          (todo . <span style="color: #de7fa8;">" %i %-12:T"</span>)
          (tags . <span style="color: #de7fa8;">" %i %-12:T"</span>)
          (search . <span style="color: #de7fa8;">" %i %-12:T"</span>)))

  (setq org-agenda-tags-column -100
        org-habit-graph-column 45
        org-habit-preceding-days 28
        org-habit-following-days 1
        org-agenda-start-with-log-mode t)

  (setq org-clock-history-length 32
        org-clock-in-resume t)
  (setq org-log-into-drawer t
        org-clock-into-drawer t)

  (setq org-clock-persist 't)
  (org-clock-persistence-insinuate)

  (setq org-use-fast-tag-selection nil)

  (setq org-capture-templates
        '((<span style="color: #de7fa8;">"t"</span> <span style="color: #de7fa8;">"New TODO"</span> entry
           (file+headline <span style="color: #de7fa8;">"todo.org.gz"</span> <span style="color: #de7fa8;">"Tasks"</span>)
           <span style="color: #de7fa8;">"* TODO %^{Title} %^G\n %u\n %?\n\n\n"</span>)
          (<span style="color: #de7fa8;">"p"</span> <span style="color: #de7fa8;">"New Project Proposal"</span> entry
           (file+headline <span style="color: #de7fa8;">"proj.org.gz"</span> <span style="color: #de7fa8;">"Projects"</span>)
           <span style="color: #de7fa8;">"* %^{Title} %^G\n %u\n %?\n\n\n"</span>)))

  (setq org-latex-pdf-process
        (quote (<span style="color: #de7fa8;">"texi2dvi --pdf --clean --verbose --batch %f"</span>)))

  (add-to-list
   'org-latex-classes
   '(<span style="color: #de7fa8;">"scrartcl"</span>
     <span style="color: #de7fa8;">"\\documentclass{scrartcl} [NO-DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]"</span>
     (<span style="color: #de7fa8;">"\\section{%s}"</span> . <span style="color: #de7fa8;">"\\section*{%s}"</span>)
     (<span style="color: #de7fa8;">"\\subsection{%s}"</span> . <span style="color: #de7fa8;">"\\subsection*{%s}"</span>)
     (<span style="color: #de7fa8;">"\\subsubsection{%s}"</span> . <span style="color: #de7fa8;">"\\subsubsection*{%s}"</span>)
     (<span style="color: #de7fa8;">"\\paragraph{%s}"</span> . <span style="color: #de7fa8;">"\\paragraph*{%s}"</span>)
     (<span style="color: #de7fa8;">"\\subparagraph{%s}"</span> . <span style="color: #de7fa8;">"\\subparagraph*{%s}"</span>)))

  (add-to-list
   'org-latex-classes
   '(<span style="color: #de7fa8;">"scrreprt"</span>
     <span style="color: #de7fa8;">"\\documentclass{scrreprt} [NO-DEFAULT-PACKAGES] [NO-PACKAGES] [EXTRA]"</span>
     (<span style="color: #de7fa8;">"\\section{%s}"</span> . <span style="color: #de7fa8;">"\\section*{%s}"</span>)
     (<span style="color: #de7fa8;">"\\subsection{%s}"</span> . <span style="color: #de7fa8;">"\\subsection*{%s}"</span>)
     (<span style="color: #de7fa8;">"\\subsubsection{%s}"</span> . <span style="color: #de7fa8;">"\\subsubsection*{%s}"</span>)
     (<span style="color: #de7fa8;">"\\paragraph{%s}"</span> . <span style="color: #de7fa8;">"\\paragraph*{%s}"</span>)
     (<span style="color: #de7fa8;">"\\subparagraph{%s}"</span> . <span style="color: #de7fa8;">"\\subparagraph*{%s}"</span>)))

  (setq org-publish-project-alist '((<span style="color: #de7fa8;">"emacsdotd"</span>
                                     <span style="color: #729fcf;">:base-directory</span> <span style="color: #de7fa8;">"~/.emacs.d/"</span>
                                     <span style="color: #729fcf;">:base-extension</span> <span style="color: #de7fa8;">"org"</span>
                                     <span style="color: #729fcf;">:publishing-directory</span> <span style="color: #de7fa8;">"~/Documents/emacsdotd"</span>
                                     <span style="color: #729fcf;">:publishing-function</span> org-html-publish-to-html
                                     <span style="color: #729fcf;">:htmlized-source</span> t))))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-3" class="outline-3">
<h3 id="sec-5-3"><span class="section-number-3">5.3</span> Helm</h3>
<div class="outline-text-3" id="text-5-3">
<p>
<a href="https://emacs-helm.github.io/helm/">Helm</a> is really <a href="http://tuhdo.github.io/helm-intro.html">a package in a league of its own</a>.  It deserves a
separete section for all its related configuration.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">defvar</span> <span style="color: #ff2929;">helm-command-prefix-key</span>)
(setq helm-command-prefix-key nil)
(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">helm-config</span>
  <span style="color: #729fcf;">:bind-keymap</span> (<span style="color: #de7fa8;">"C-c h"</span> . helm-command-map)
  <span style="color: #729fcf;">:bind</span> (<span style="color: #de7fa8;">"&lt;f9&gt;"</span> . helm-recentf)
  <span style="color: #729fcf;">:config</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Some custom helm bindings</span>
  (define-key helm-command-map (kbd <span style="color: #de7fa8;">"a"</span>) #'helm-apropos)
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">c helm-colors</span>
  (define-key helm-command-map (kbd <span style="color: #de7fa8;">"b"</span>) #'helm-bibtex)
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">e helm-etags-select</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">f helm-multi-files</span>
  (define-key helm-command-map (kbd <span style="color: #de7fa8;">"g"</span>) #'helm-do-grep)
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">h help</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">i helm-semantic-or-imenu</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">l helm-locate</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">m helm-man-woman</span>
  (define-key helm-command-map (kbd <span style="color: #de7fa8;">"o"</span>) #'helm-occur)
  (define-key helm-command-map (kbd <span style="color: #de7fa8;">"p"</span>) #'helm-projectile)
  (define-key helm-command-map (kbd <span style="color: #de7fa8;">"SPC"</span>) #'helm-all-mark-rings)
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">r helm-regexp</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">s helm-surfraw</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">t helm-top</span>

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">rebind tab to run persistent action</span>
  (define-key helm-map (kbd <span style="color: #de7fa8;">"&lt;tab&gt;"</span>) 'helm-execute-persistent-action)
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">make TAB works in terminal</span>
  (define-key helm-map (kbd <span style="color: #de7fa8;">"C-i"</span>) 'helm-execute-persistent-action)
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">list actions using C-z</span>
  (define-key helm-map (kbd <span style="color: #de7fa8;">"C-z"</span>)  'helm-select-action)

  (setq helm-recentf-fuzzy-match t
        helm-buffers-fuzzy-matching t
        helm-split-window-in-side-p t
        helm-ff-search-library-in-sexp t
        helm-ff-file-name-history-use-recentf t
        helm-scroll-amount 8
        helm-completion-in-region-fuzzy-match t
        helm-mode-fuzzy-match t
        helm-M-x-fuzzy-match t)

  (setq helm-semantic-fuzzy-match t
        helm-imenu-fuzzy-match    t)

  (helm-mode +1)
  (helm-autoresize-mode t))
</pre>
</div>
</div>

<div id="outline-container-sec-5-3-1" class="outline-4">
<h4 id="sec-5-3-1"><span class="section-number-4">5.3.1</span> Helm-files</h4>
<div class="outline-text-4" id="text-5-3-1">
<div class="org-src-container">

<pre class="src src-emacs-lisp">  (<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">helm-files</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-3-2" class="outline-4">
<h4 id="sec-5-3-2"><span class="section-number-4">5.3.2</span> Helm-bibtex</h4>
<div class="outline-text-4" id="text-5-3-2">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">helm-bibtex</span>
  <span style="color: #729fcf;">:config</span>
  (setq helm-bibtex-bibliography
        `(,(expand-file-name <span style="color: #de7fa8;">"~/Dropbox/bibliography/sp.bib"</span>)
          ,(expand-file-name <span style="color: #de7fa8;">"~/Dropbox/bibliography/nn.bib"</span>)))

  (setq helm-bibtex-library-path
        `(,(expand-file-name <span style="color: #de7fa8;">"~/Dropbox/bibliography/sp-pdf"</span>)
          ,(expand-file-name <span style="color: #de7fa8;">"~/Dropbox/bibliography/nn-pdf"</span>)))

  (setq helm-bibtex-notes-path
        (expand-file-name <span style="color: #de7fa8;">"~/Dropbox/bibliography/notes"</span>))
  (setq helm-bibtex-notes-extension <span style="color: #de7fa8;">".org"</span>)

  (setq helm-bibtex-pdf-open-function
        (<span style="color: #729fcf; font-weight: bold;">lambda</span> (fpath)
          (async-start-process <span style="color: #de7fa8;">"evince"</span> <span style="color: #de7fa8;">"/usr/bin/evince"</span> nil fpath))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-sec:miscpac" class="outline-3">
<h3 id="sec:miscpac"><a id="sec-5-4" name="sec-5-4"></a><span class="section-number-3">5.4</span> Miscellaneous Packages</h3>
<div class="outline-text-3" id="text-sec:miscpac">

<p>
The followings are light yet serious functionalities.  Some of which
that are wrapped in <code>(when (display-graphic-p) ...)</code> are intended to
be loaded only in GUI mode.  When in console mode, e.g., editing
files through SSH, I only need core editing functions.
</p>
</div>

<div id="outline-container-sec-5-4-1" class="outline-4">
<h4 id="sec-5-4-1"><span class="section-number-4">5.4.1</span> Diminish</h4>
<div class="outline-text-4" id="text-5-4-1">
<p>
Make minor modes invisible.  As quoted from Will Mengarini in
<a href="http://www.eskimo.com/~seldon/diminish.el">diminish.el</a>,
</p>

<blockquote>
<p>
When we diminish a mode, we are saying we want it to continue doing
its work for us, but we no longer want to be reminded of it. It
becomes a night worker, like a janitor; it becomes an invisible man;
it remains a component, perhaps an important one, sometimes an
indispensable one, of the mechanism that maintains the day-people's
world, but its place in their thoughts is diminished, usually to
nothing. As we grow old we diminish more and more such thoughts,
such people, usually to nothing.
</p>
</blockquote>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">diminish</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-2" class="outline-4">
<h4 id="sec-5-4-2"><span class="section-number-4">5.4.2</span> Ace-jump</h4>
</div>
<div id="outline-container-sec-5-4-3" class="outline-4">
<h4 id="sec-5-4-3"><span class="section-number-4">5.4.3</span> Ag</h4>
<div class="outline-text-4" id="text-5-4-3">
<p>
Search like crazy.  It is a code-searching tool alternative for ack
related frontend, e.g., ack-and-a-half, which is not actively
maintained anymore.  I included this package but never used before!!
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">ag</span>
  <span style="color: #729fcf;">:defines</span> my-ag-keymap
  <span style="color: #729fcf;">:bind-keymap</span> (<span style="color: #de7fa8;">"C-c a"</span> . my-ag-map)
  <span style="color: #729fcf;">:config</span>

  (setq ag-reuse-buffers t    <span style="color: #babdb6; font-style: italic;">; </span><span style="color: #babdb6; font-style: italic;">Don't spam buffer list with ag buffers</span>
        ag-highlight-search t <span style="color: #babdb6; font-style: italic;">; </span><span style="color: #babdb6; font-style: italic;">A little fanciness</span>

        <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Use Projectile to find the project root</span>
        ag-project-root-function
        (<span style="color: #729fcf; font-weight: bold;">lambda</span> (d)
          (<span style="color: #729fcf; font-weight: bold;">let</span> ((default-directory d))
            (projectile-project-root))))

  (<span style="color: #729fcf; font-weight: bold;">defvar</span> <span style="color: #ff2929;">my-ag-map</span>
    (<span style="color: #729fcf; font-weight: bold;">let</span> ((map (make-sparse-keymap)))
      (define-key map (kbd <span style="color: #de7fa8;">"a"</span>) #'ag-regexp)
      (define-key map (kbd <span style="color: #de7fa8;">"p"</span>) #'ag-project-regexp)

      map)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-4" class="outline-4">
<h4 id="sec-5-4-4"><span class="section-number-4">5.4.4</span> Anzu</h4>
<div class="outline-text-4" id="text-5-4-4">
<p>
Display in the modeline search information, i.e, <code>(cur/total)</code>,
where <code>cur</code> is the current index of searched keyword and total is
number of totally matched keywords in the current buffer, as shown
in Figure <a href="#fig:anzu">1</a>.
</p>


<figure id="fig:anzu">
<p><img src="./img/anzu.png" alt="anzu.png">
</p>
<figcaption><span class="figure-number">Figure 1:</span> Anzu minor mode</figcaption>
</figure>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">anzu</span>
  <span style="color: #729fcf;">:init</span> (global-anzu-mode +1)
  <span style="color: #729fcf;">:diminish</span> anzu-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-5" class="outline-4">
<h4 id="sec-5-4-5"><span class="section-number-4">5.4.5</span> Appt</h4>
<div class="outline-text-4" id="text-5-4-5">
<blockquote>
<p>
The Emacs diary keeps track of appointments or other events on a
daily basis, in conjunction with the calendar.
</p>
</blockquote>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">when</span> (display-graphic-p)
  (setq diary-file (expand-file-name <span style="color: #de7fa8;">"diary"</span> my-personal-dir)))
</pre>
</div>

<p>
Show diary when I view the calendar.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq calendar-view-diary-initially-flag t)
</pre>
</div>

<p>
Activate appointment management and remind Org agenda as appoinment,
only in GUI mode.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">when</span> (display-graphic-p)
  (appt-activate 1)
  (add-hook 'org-finalize-agenda-hook 'org-agenda-to-appt))
</pre>
</div>

<p>
Display the coming appointment in a notification popup.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">when</span> (display-graphic-p)
  (<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">my-appt-display</span> (mins-till-appt cur-time msg)
    <span style="color: #babdb6; font-style: italic;">"Convinient wrapper for appt popup display"</span>
    (notifications-notify
     <span style="color: #729fcf;">:title</span> (format <span style="color: #de7fa8;">"Appt in %s minute(s)"</span> mins-till-appt)
     <span style="color: #729fcf;">:body</span> msg
     <span style="color: #729fcf;">:app-icon</span> (expand-file-name <span style="color: #de7fa8;">"appointment-soon.png"</span> my-icons-dir)))

  (setq appt-disp-window-function (function my-appt-display)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-6" class="outline-4">
<h4 id="sec-5-4-6"><span class="section-number-4">5.4.6</span> Async</h4>
<div class="outline-text-4" id="text-5-4-6">
<p>
Async in Emacs?  Cool!
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">async</span>
  <span style="color: #729fcf;">:commands</span> (dired-async-mode)
  <span style="color: #729fcf;">:init</span> (dired-async-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-7" class="outline-4">
<h4 id="sec-5-4-7"><span class="section-number-4">5.4.7</span> BBDB</h4>
<div class="outline-text-4" id="text-5-4-7">
<p>
<a href="http://savannah.nongnu.org/projects/bbdb/">BBDB</a> (Insidious Big Brother Database) is a rolodex-like database
program for GNU Emacs.  It is mainly used to store contacts.  And it
has nice integration with Gnus.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">bbdb</span>
  <span style="color: #729fcf;">:if</span> (display-graphic-p)
  <span style="color: #729fcf;">:config</span>
  (bbdb-initialize 'gnus 'mail 'message 'anniv)

  (setq bbdb-complete-mail-allow-cycling t
        bbdb-allow-duplicates t
        bbdb-message-all-addresses t
        bbdb-file
        (expand-file-name <span style="color: #de7fa8;">"contacts.bbdb.gz"</span> my-personal-dir))

  (add-hook 'message-setup-hook 'bbdb-mail-aliases))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-8" class="outline-4">
<h4 id="sec-5-4-8"><span class="section-number-4">5.4.8</span> Browse-kill-ring</h4>
<div class="outline-text-4" id="text-5-4-8">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">browse-kill-ring</span>
  <span style="color: #729fcf;">:bind</span> (<span style="color: #de7fa8;">"C-c k"</span> . browse-kill-ring))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-9" class="outline-4">
<h4 id="sec-5-4-9"><span class="section-number-4">5.4.9</span> Deft</h4>
<div class="outline-text-4" id="text-5-4-9">
<blockquote>
<p>
<a href="http://jblevins.org/projects/deft/">Deft</a> is an Emacs mode for quickly browsing, filtering, and editing
directories of plain text notes, inspired by <a href="http://notational.net/">Notational Velocity</a>.
</p>
</blockquote>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">deft</span>
  <span style="color: #729fcf;">:if</span> (display-graphic-p)
  <span style="color: #729fcf;">:bind</span> (<span style="color: #de7fa8;">"&lt;f8&gt;"</span> . deft)
  <span style="color: #729fcf;">:config</span>
  (setq deft-extension <span style="color: #de7fa8;">"org"</span>
        deft-directory (expand-file-name <span style="color: #de7fa8;">"notes"</span> my-personal-dir)
        deft-text-mode 'org-mode
        deft-use-filename-as-title nil
        deft-auto-save-interval 0
        deft-strip-title-regexp
        (concat deft-strip-title-regexp
                <span style="color: #de7fa8;">"</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">|</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">(?:</span><span style="color: #de7fa8;">\\+TITLE:[[:space:]]+</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">)</span><span style="color: #de7fa8;">"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-10" class="outline-4">
<h4 id="sec-5-4-10"><span class="section-number-4">5.4.10</span> Dired</h4>
<div class="outline-text-4" id="text-5-4-10">
<p>
It is a really cool bultin package of which I have not yet leveraged
the full power.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(put 'dired-find-alternate-file 'disabled nil)

<span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">always delete and copy recursively</span>
(setq dired-recursive-deletes 'always
      dired-recursive-copies 'always
      dired-listing-switches <span style="color: #de7fa8;">"-alh"</span>)

(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">dired-x</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-11" class="outline-4">
<h4 id="sec-5-4-11"><span class="section-number-4">5.4.11</span> Display-time</h4>
<div class="outline-text-4" id="text-5-4-11">
<p>
Display time and unread mail notification, if not in terminal, in
the mode line.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq display-time-24hr-format t display-time-day-and-date nil)

(<span style="color: #729fcf; font-weight: bold;">when</span> (display-graphic-p)

  (setq display-time-mail-function
        (<span style="color: #729fcf; font-weight: bold;">lambda</span> () <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Gnus launched?</span>
          (<span style="color: #729fcf; font-weight: bold;">when</span> (boundp 'gnus-newsrc-alist)
            (<span style="color: #729fcf; font-weight: bold;">dolist</span> (entry gnus-newsrc-alist)
              (<span style="color: #729fcf; font-weight: bold;">let</span> ((group (car entry)))
                (<span style="color: #729fcf; font-weight: bold;">when</span> (&lt; (gnus-group-level group) 2)
                  (<span style="color: #729fcf; font-weight: bold;">let</span> ((unread (gnus-group-unread group)))
                    (<span style="color: #729fcf; font-weight: bold;">when</span> (and (numberp unread)
                               (&gt; unread 0))
                      group))))))))

  (setq display-time-use-mail-icon t
        display-time-mail-icon
        `(image <span style="color: #729fcf;">:type</span> png
                <span style="color: #729fcf;">:file</span> ,(expand-file-name <span style="color: #de7fa8;">"mail-unread.png"</span> my-icons-dir)
                <span style="color: #729fcf;">:ascent</span> center)))

(display-time)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-12" class="outline-4">
<h4 id="sec-5-4-12"><span class="section-number-4">5.4.12</span> Eshell</h4>
<div class="outline-text-4" id="text-5-4-12">
<p>
Emacs shell program.  Very handy for remote console access.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">eshell</span>
  <span style="color: #729fcf;">:config</span>
  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">Truncate eshell buffer just in case you got megabytes of output</span>
  (add-to-list 'eshell-output-filter-functions 'eshell-truncate-buffer)
  (setq eshell-directory-name (expand-file-name <span style="color: #de7fa8;">"eshell"</span> my-tmp)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-13" class="outline-4">
<h4 id="sec-5-4-13"><span class="section-number-4">5.4.13</span> ESS</h4>
<div class="outline-text-4" id="text-5-4-13">
<blockquote>
<p>
<a href="http://ess.r-project.org/">ESS</a> (Emacs Speaks Statistics) is an add-on package for Emacs text
editors such as GNU Emacs and XEmacs.  It is designed to support
editing of scripts and interaction with various statistical analysis
programs such as R, S-Plus, SAS, Stata and OpenBUGS/JAGS.
</p>
</blockquote>

<p>
I think <a href="http://julialang.org/">Julia</a> is also supported.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">ess-site</span>
  <span style="color: #729fcf;">:config</span>
  (add-hook 'ess-mode-hook
            (<span style="color: #729fcf; font-weight: bold;">lambda</span> ()
              (setq ess-help-own-frame 'one)
              (setq ess-indent-level 2)
              (setq ess-first-continued-statement-offset 2)
              (setq ess-continued-statement-offset 0)
              (setq ess-tab-complete-in-script t)
              (setq ess-first-tab-never-complete
                    'symbol-or-paren-or-punct)))

  (add-hook 'inferior-ess-mode-hook
            (<span style="color: #729fcf; font-weight: bold;">lambda</span> ()
              (smartparens-mode 1))))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-14" class="outline-4">
<h4 id="sec-5-4-14"><span class="section-number-4">5.4.14</span> Expand-region</h4>
<div class="outline-text-4" id="text-5-4-14">
<p>
Select the region in a DWIW style.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">expand-region</span>
  <span style="color: #729fcf;">:bind</span> (<span style="color: #de7fa8;">"C-="</span> . er/expand-region))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-15" class="outline-4">
<h4 id="sec-5-4-15"><span class="section-number-4">5.4.15</span> Flycheck</h4>
<div class="outline-text-4" id="text-5-4-15">
<p>
Eamcs Front-end for various languages syntax checker.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">flycheck</span>
  <span style="color: #729fcf;">:if</span> (display-graphic-p)
  <span style="color: #729fcf;">:config</span>
  (add-hook 'after-init-hook #'global-flycheck-mode)
  <span style="color: #729fcf;">:diminish</span> flycheck-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-16" class="outline-4">
<h4 id="sec-5-4-16"><span class="section-number-4">5.4.16</span> Javascript</h4>
<div class="outline-text-4" id="text-5-4-16">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">js2-mode</span>
  <span style="color: #729fcf;">:mode</span> <span style="color: #de7fa8;">"\\.js\\'"</span>
  <span style="color: #729fcf;">:config</span>
  (setq js2-basic-offset 2
        js2-include-node-externs t
        js2-include-browser-externs t)

  (rename-modeline <span style="color: #de7fa8;">"js2-mode"</span> js2-mode <span style="color: #de7fa8;">"JS2"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-17" class="outline-4">
<h4 id="sec-5-4-17"><span class="section-number-4">5.4.17</span> Hi-mode</h4>
<div class="outline-text-4" id="text-5-4-17">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">hi-lock-mode</span>
  <span style="color: #729fcf;">:diminish</span> hi-lock-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-18" class="outline-4">
<h4 id="sec-5-4-18"><span class="section-number-4">5.4.18</span> Ibuffer</h4>
<div class="outline-text-4" id="text-5-4-18">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">ibuffer</span>
  <span style="color: #729fcf;">:config</span>

  (setq ibuffer-saved-filter-groups
        `((<span style="color: #de7fa8;">"default"</span>
           (<span style="color: #de7fa8;">"Planner"</span>
            (or (mode . org-agenda-mode)
                (filename . <span style="color: #de7fa8;">"/home/gongzhitaao/Dropbox/emacs/personal/org/"</span>)
                (name . <span style="color: #de7fa8;">"\\.bbdb"</span>)
                (mode . bbdb-mode)
                (name . <span style="color: #de7fa8;">"^\\*Calendar\\*$"</span>)
                (name . <span style="color: #de7fa8;">"^diary$"</span>)))
           (<span style="color: #de7fa8;">"Dired"</span> (mode . dired-mode))
           (<span style="color: #de7fa8;">"Web"</span>
            (or (name . <span style="color: #de7fa8;">"\\.js"</span>)
                (name . <span style="color: #de7fa8;">"\\.css"</span>)
                (name . <span style="color: #de7fa8;">"\\.html"</span>)
                (name . <span style="color: #de7fa8;">"\\.php"</span>)
                (name . <span style="color: #de7fa8;">"\\.xml"</span>)
                (mode . yaml-mode)))
           (<span style="color: #de7fa8;">"Text"</span>
            (or (name . <span style="color: #de7fa8;">"\\.</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">(</span><span style="color: #de7fa8;">tex</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">|</span><span style="color: #de7fa8;">bib</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">|</span><span style="color: #de7fa8;">csv</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">)</span><span style="color: #de7fa8;">"</span>)
                (mode . org-mode)
                (mode . markdown-mode)
                (mode . text-mode)))
           (<span style="color: #de7fa8;">"Data"</span>
            (or (mode . gnuplot-mode)
                (mode . octave-mode)
                (mode . R-mode)))
           (<span style="color: #de7fa8;">"Coding"</span>
            (or (mode . shell-script-mode)
                (mode . sh-mode)
                (mode . emacs-lisp-mode)
                (name . <span style="color: #de7fa8;">"\\.[ch]</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">(</span><span style="color: #de7fa8;">pp</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">|</span><span style="color: #de7fa8;">xx</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">|</span><span style="color: #de7fa8;">\\+\\+</span><span style="color: #de7fa8; font-weight: bold;">\\</span><span style="color: #de7fa8; font-weight: bold;">)</span><span style="color: #de7fa8;">?"</span>)
                (mode . python-mode)
                (name . <span style="color: #de7fa8;">"\\.ya?ml"</span>)
                (name . <span style="color: #de7fa8;">"\\.sql"</span>)))
           (<span style="color: #de7fa8;">"Mail"</span>
            (or (mode . message-mode)
                (mode . mail-mode)
                (mode . gnus-group-mode)
                (mode . gnus-summary-mode)
                (mode . gnus-article-mode)
                (mode . gnus-server-mode)
                (mode . gnus-browse-mode)
                (name . <span style="color: #de7fa8;">"^\\.newsrc-dribble"</span>)))
           (<span style="color: #de7fa8;">"Console"</span>
            (or (mode . inferior-ess-mode)
                (mode . inferior-python-mode)
                (mode . eshell-mode)
                (mode . gnuplot-comint-mode)
                (mode . comint-mode)))
           (<span style="color: #de7fa8;">"Helper"</span>
            (or (mode . makefile-mode)
                (mode . makefile-gmake-mode)
                (mode . cmake-mode)
                (mode . calc-mode)
                (mode . Info-mode)
                (mode . help-mode)
                (mode . ess-help-mode)
                (name . <span style="color: #de7fa8;">"^\\*scratch\\*$"</span>))))))

  (add-hook
   'ibuffer-mode-hook
   (<span style="color: #729fcf; font-weight: bold;">lambda</span> ()
     (ibuffer-auto-mode 1)
     (ibuffer-switch-to-saved-filter-groups <span style="color: #de7fa8;">"default"</span>)
     (local-set-key (kbd <span style="color: #de7fa8;">"&lt;right&gt;"</span>) 'ibuffer-forward-filter-group)
     (local-set-key (kbd <span style="color: #de7fa8;">"&lt;left&gt;"</span>) 'ibuffer-backward-filter-group)
     (hl-line-mode 1)))

  (define-ibuffer-column size-h
    (<span style="color: #729fcf;">:name</span> <span style="color: #de7fa8;">"Size"</span> <span style="color: #729fcf;">:inline</span> t)
    (<span style="color: #729fcf; font-weight: bold;">cond</span> ((&gt; (buffer-size) 1000)
           (format <span style="color: #de7fa8;">"%7.1fk"</span> (/ (buffer-size) 1000.0)))
          ((&gt; (buffer-size) 1000000)
           (format <span style="color: #de7fa8;">"%7.1fM"</span> (/ (buffer-size) 1000000.0)))
          (t (format <span style="color: #de7fa8;">"%8dB"</span> (buffer-size)))))

  (setq ibuffer-formats
        '((mark modified read-only <span style="color: #de7fa8;">" "</span>
                (name 18 18 <span style="color: #729fcf;">:left</span> <span style="color: #729fcf;">:elide</span>) <span style="color: #de7fa8;">" "</span>
                (size-h 9 -1 <span style="color: #729fcf;">:right</span>) <span style="color: #de7fa8;">" "</span>
                (mode 16 16 <span style="color: #729fcf;">:left</span> <span style="color: #729fcf;">:elide</span>) <span style="color: #de7fa8;">" "</span>
                filename-and-process))))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-19" class="outline-4">
<h4 id="sec-5-4-19"><span class="section-number-4">5.4.19</span> Ido</h4>
<div class="outline-text-4" id="text-5-4-19">
<p>
I just switched from <code>ido</code> to <code>helm</code>.  It just feel more natural
working with <code>helm</code>.  What's more, <code>helm</code> is really <i>ubiquituous</i>.
</p>

<p>
The following configuration is only kept for backup.  They are
already deprecated.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">ido</span>
  <span style="color: #729fcf;">:config</span>
  (ido-mode 'both)

  (setq ido-save-directory-list-file
        (expand-file-name <span style="color: #de7fa8;">"idolast"</span> my-tmp)
        <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">ignore these buffers during completion</span>
        ido-ignore-buffers
        '(<span style="color: #de7fa8;">"\\` "</span> <span style="color: #de7fa8;">"^\*Mess"</span> <span style="color: #de7fa8;">"^\*Back"</span> <span style="color: #de7fa8;">".*Completion"</span> <span style="color: #de7fa8;">"^\*Ido"</span> <span style="color: #de7fa8;">"^\*trace"</span> <span style="color: #de7fa8;">"^\*compilation"</span> <span style="color: #de7fa8;">"^\*GTAGS"</span> <span style="color: #de7fa8;">"^session\.*"</span> <span style="color: #de7fa8;">"^\*"</span>)
        <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">case insensitive</span>
        ido-case-fold t
        <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">remember last directory</span>
        ido-enable-last-directory-history t
        ido-max-work-file-list 50
        ido-use-filename-at-point nil
        ido-use-url-at-point nil
        ido-enable-flex-matching nil
        ido-max-prospects 6
        ido-confirm-unique-completion t)

  <span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">increase minibuffer size when ido completion is active</span>
  (add-hook 'ido-minibuffer-setup-hook
            (function
             (<span style="color: #729fcf; font-weight: bold;">lambda</span> ()
               (make-local-variable
                'resize-minibuffer-window-max-height)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-20" class="outline-4">
<h4 id="sec-5-4-20"><span class="section-number-4">5.4.20</span> Lua-mode</h4>
<div class="outline-text-4" id="text-5-4-20">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">lua-mode</span>
  <span style="color: #729fcf;">:mode</span> <span style="color: #de7fa8;">"\\.lua\\'"</span>
  <span style="color: #729fcf;">:config</span>
  (define-key lua-mode-map (kbd <span style="color: #de7fa8;">"C-&lt;return&gt;"</span>) #'lua-send-current-line)
  (define-key lua-mode-map (kbd <span style="color: #de7fa8;">"C-c b"</span>) #'lua-send-buffer)
  (define-key lua-mode-map (kbd <span style="color: #de7fa8;">"C-c C-b"</span>) #'lua-send-buffer)
  (define-key lua-mode-map (kbd <span style="color: #de7fa8;">"C-c f"</span>) #'lua-send-defun)
  (define-key lua-mode-map (kbd <span style="color: #de7fa8;">"C-c C-f"</span>) #'lua-send-defun)
  (define-key lua-mode-map (kbd <span style="color: #de7fa8;">"C-c r"</span>) #'lua-send-region)
  (define-key lua-mode-map (kbd <span style="color: #de7fa8;">"C-c C-r"</span>) #'lua-send-region))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-21" class="outline-4">
<h4 id="sec-5-4-21"><span class="section-number-4">5.4.21</span> Midnight</h4>
<div class="outline-text-4" id="text-5-4-21">
<p>
What is <code>midnight-mode</code> for?  Included but never used&#x2026;
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">midnight</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-22" class="outline-4">
<h4 id="sec-5-4-22"><span class="section-number-4">5.4.22</span> Multiple-cursors</h4>
<div class="outline-text-4" id="text-5-4-22">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">multiple-cursors</span>
  <span style="color: #729fcf;">:defines</span> my-multiple-cursors-map
  <span style="color: #729fcf;">:bind-keymap</span> (<span style="color: #de7fa8;">"C-c m"</span> . my-multiple-cursors-map)
  <span style="color: #729fcf;">:config</span>
  (<span style="color: #729fcf; font-weight: bold;">defvar</span> <span style="color: #ff2929;">my-multiple-cursors-map</span>
    (<span style="color: #729fcf; font-weight: bold;">let</span> ((map (make-sparse-keymap)))
      (define-key map (kbd <span style="color: #de7fa8;">"l"</span>) #'mc/edit-lines)
      (define-key map (kbd <span style="color: #de7fa8;">"C-a"</span>) #'mc/edit-beginnings-of-lines)
      (define-key map (kbd <span style="color: #de7fa8;">"C-e"</span>) #'mc/edit-ends-of-lines)
      (define-key map (kbd <span style="color: #de7fa8;">"C-s"</span>) #'mc/mark-all-in-region)
      (define-key map (kbd <span style="color: #de7fa8;">"n"</span>) #'mc/mark-next-like-this)
      (define-key map (kbd <span style="color: #de7fa8;">"p"</span>) #'mc/mark-previous-like-this)
      (define-key map (kbd <span style="color: #de7fa8;">"e"</span>) #'mc/mark-more-like-this-extended)
      (define-key map (kbd <span style="color: #de7fa8;">"h"</span>) #'mc/mark-all-like-this-dwim)
      (define-key map (kbd <span style="color: #de7fa8;">"r"</span>) #'mc/mark-all-in-region-regexp)

      map)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-23" class="outline-4">
<h4 id="sec-5-4-23"><span class="section-number-4">5.4.23</span> Projectile</h4>
<div class="outline-text-4" id="text-5-4-23">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">projectile</span>
  <span style="color: #729fcf;">:init</span>
  (projectile-global-mode)
  <span style="color: #729fcf;">:config</span>
  (define-key projectile-mode-map [remap projectile-ack] #'projectile-ag)
  (setq projectile-completion-system 'grizzl)
  <span style="color: #729fcf;">:diminish</span> projectile-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-24" class="outline-4">
<h4 id="sec-5-4-24"><span class="section-number-4">5.4.24</span> Recentf</h4>
<div class="outline-text-4" id="text-5-4-24">
<p>
Save recently opened files.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">recentf</span>
  <span style="color: #729fcf;">:config</span>
  (setq recentf-save-file (expand-file-name <span style="color: #de7fa8;">"recentf"</span> my-tmp))
  (add-to-list 'recentf-exclude (expand-file-name <span style="color: #de7fa8;">".*"</span> my-tmp))
  (add-to-list 'recentf-exclude (expand-file-name <span style="color: #de7fa8;">"elpa/.*"</span> my-dir))
  (add-to-list 'recentf-exclude (expand-file-name <span style="color: #de7fa8;">"~/.newsrc*"</span>))
  (add-to-list 'recentf-exclude (expand-file-name my-personal-dir))
  (add-to-list 'recentf-exclude (expand-file-name <span style="color: #de7fa8;">".cask/.*"</span> my-dir))
  (recentf-mode +1))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-25" class="outline-4">
<h4 id="sec-5-4-25"><span class="section-number-4">5.4.25</span> Savehist</h4>
<div class="outline-text-4" id="text-5-4-25">
<p>
Save minibuffer history.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">savehist</span>
  <span style="color: #729fcf;">:init</span>
  (savehist-mode +1)
  <span style="color: #729fcf;">:config</span>
  (setq savehist-additional-variables '(search ring regexp-search-ring)
        savehist-file (expand-file-name <span style="color: #de7fa8;">"savehist"</span> my-tmp)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-26" class="outline-4">
<h4 id="sec-5-4-26"><span class="section-number-4">5.4.26</span> Saveplace</h4>
<div class="outline-text-4" id="text-5-4-26">
<p>
Save places in a file so that you can go back when you reopen it.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">saveplace</span>
  <span style="color: #729fcf;">:init</span>
  (setq-default save-place t)
  <span style="color: #729fcf;">:config</span>
  (setq save-place-file (expand-file-name <span style="color: #de7fa8;">"saveplace"</span> my-tmp)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-27" class="outline-4">
<h4 id="sec-5-4-27"><span class="section-number-4">5.4.27</span> Smartparens</h4>
<div class="outline-text-4" id="text-5-4-27">
<blockquote>
<p>
Smartparens is minor mode for Emacs that <i>deals with parens pairs
and tries to be smart about it</i>.
</p>
</blockquote>

<p>
This is a really <i>smart</i> and <i>useful</i> package.  <i>However it takes a
while, maybe quite a while, to get used to its intelligence</i>.  For
most editors (I really mean editors other than Emacs), I can not
imagine I may have all these convenient options of dealing with
parens.  Take as an simple example, kill the ballanced expression.
</p>

<div class="org-src-container">

<pre class="src src-lisp">(func1 (func2 (func3)))
</pre>
</div>

<p>
Suppose you want to delete <code>(func2 ...)</code>, normally I would delete
character by character, or hightlight manually and then delete.
With <i>smartparens</i>, I may place cursor at the opening bracket of
<code>func2</code> and <kbd>M-x</kbd> <code>sp-kill-sexp</code> would kill the whole
<code>func2</code> expression.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">smartparens</span>
  <span style="color: #729fcf;">:init</span>

  (smartparens-global-mode t)
  (show-smartparens-global-mode 1)

  <span style="color: #729fcf;">:diminish</span> smartparens-mode

  <span style="color: #729fcf;">:config</span>

  (<span style="color: #729fcf; font-weight: bold;">sp-with-modes</span>
      '(tex-mode plain-tex-mode latex-mode)
    (sp-local-tag <span style="color: #de7fa8;">"i"</span> <span style="color: #de7fa8;">"\"&lt;"</span> <span style="color: #de7fa8;">"\"&gt;"</span>)
    (sp-local-tag <span style="color: #de7fa8;">"i"</span> <span style="color: #de7fa8;">"\"["</span> <span style="color: #de7fa8;">"\"]"</span>))

  (--each '(<span style="color: #de7fa8;">"*"</span> <span style="color: #de7fa8;">"/"</span> <span style="color: #de7fa8;">"="</span> <span style="color: #de7fa8;">"~"</span>)
    (sp-local-pair 'org-mode it it))

  (sp-local-pair '(emacs-lisp-mode lisp-mode) <span style="color: #de7fa8;">"`"</span> <span style="color: #de7fa8;">"'"</span>)
  (sp-local-pair '(emacs-lisp-mode lisp-mode) <span style="color: #de7fa8;">"`"</span>
                 nil <span style="color: #729fcf;">:when</span> '(sp-in-string-p))
  (sp-local-pair '(emacs-lisp-mode lisp-mode) <span style="color: #de7fa8;">"'"</span>
                 nil <span style="color: #729fcf;">:actions</span> nil)

  (setq sp-cancel-autoskip-on-backward-movement nil)
  (setq sp-navigate-consider-stringlike-sexp
        '(lisp-mode emacs-lisp-mode latex-mode LaTeX-mode TeX-mode))

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s f"</span>) 'sp-forward-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s b"</span>) 'sp-backward-sexp)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s d"</span>) 'sp-down-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s D"</span>) 'sp-backward-down-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s a"</span>) 'sp-beginning-of-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s e"</span>) 'sp-end-of-sexp)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s u"</span>) 'sp-up-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s U"</span>) 'sp-backward-up-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s t"</span>) 'sp-transpose-sexp)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s n"</span>) 'sp-next-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s p"</span>) 'sp-previous-sexp)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s k"</span>) 'sp-kill-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s w"</span>) 'sp-copy-sexp)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s s"</span>) 'sp-forward-slurp-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s r"</span>) 'sp-forward-barf-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s S"</span>) 'sp-backward-slurp-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s R"</span>) 'sp-backward-barf-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s F"</span>) 'sp-forward-symbol)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s B"</span>) 'sp-backward-symbol)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s ["</span>) 'sp-select-previous-thing)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s ]"</span>) 'sp-select-next-thing)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-i"</span>) 'sp-splice-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s &lt;delete&gt;"</span>) 'sp-splice-sexp-killing-forward)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s &lt;backspace&gt;"</span>) 'sp-splice-sexp-killing-backward)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-&lt;backspace&gt;"</span>) 'sp-splice-sexp-killing-around)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-w"</span>) 'sp-wrap)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-u"</span>) 'sp-unwrap-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-b"</span>) 'sp-backward-unwrap-sexp)

  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-t"</span>) 'sp-prefix-tag-object)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-p"</span>) 'sp-prefix-pair-object)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-c"</span>) 'sp-convolute-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-a"</span>) 'sp-absorb-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-e"</span>) 'sp-emit-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-p"</span>) 'sp-add-to-previous-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-n"</span>) 'sp-add-to-next-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-j"</span>) 'sp-join-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-s"</span>) 'sp-split-sexp)
  (define-key smartparens-mode-map (kbd <span style="color: #de7fa8;">"C-c s C-r"</span>) 'sp-raise-sexp))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-28" class="outline-4">
<h4 id="sec-5-4-28"><span class="section-number-4">5.4.28</span> Tex</h4>
<div class="outline-text-4" id="text-5-4-28">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq TeX-auto-save t)
(setq TeX-parse-self t)

(setq bibtex-dialect 'biblatex)
(setq bibtex-align-at-equal-sign t)
(setq bibtex-text-indentation 20)

(add-hook 'bibtex-mode-hook
          (<span style="color: #729fcf; font-weight: bold;">lambda</span> ()
            (local-set-key (kbd <span style="color: #de7fa8;">"C-c \\"</span>) 'bibtex-fill-entry)
            (setq fill-column 140)))

(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">reftex</span>
  <span style="color: #729fcf;">:diminish</span> reftex-mode
  <span style="color: #729fcf;">:config</span>
  (add-hook 'latex-mode-hook 'turn-on-reftex)
  (add-hook 'LaTeX-mode-hook 'turn-on-reftex)
  (setq reftex-plug-into-AUCTeX t
        reftex-ref-style-default-list '(<span style="color: #de7fa8;">"Cleveref"</span> <span style="color: #de7fa8;">"Hyperref"</span> <span style="color: #de7fa8;">"Fancyref"</span>)
        reftex-default-bibliography
        '(<span style="color: #de7fa8;">"/home/gongzhitaao/Dropbox/bib/nn.bib"</span>
          <span style="color: #de7fa8;">"/home/gongzhitaao/Dropbox/bib/sp.bib"</span>)))

(add-hook 'latex-mode-hook 'turn-on-auto-fill)
(add-hook 'LaTeX-mode-hook 'turn-on-auto-fill)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-29" class="outline-4">
<h4 id="sec-5-4-29"><span class="section-number-4">5.4.29</span> TRAMP</h4>
<div class="outline-text-4" id="text-5-4-29">
<p>
Use <i>TRAMP</i> (Transparent Remote Access, Multiple Protocols) to edit
remote files.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">tramp</span>
  <span style="color: #729fcf;">:config</span>
  (setq tramp-default-method <span style="color: #de7fa8;">"ssh"</span>
        tramp-persistency-file-name
        (expand-file-name <span style="color: #de7fa8;">"tramp"</span> my-tmp)))
</pre>
</div>

<p>
Expand region increases the selected region by semantic units.  I
included this package but never knew it before!!
</p>
</div>
</div>

<div id="outline-container-sec-5-4-30" class="outline-4">
<h4 id="sec-5-4-30"><span class="section-number-4">5.4.30</span> Undo-tree</h4>
<div class="outline-text-4" id="text-5-4-30">
<p>
Visualize the undo list in a tree-like structure for easy undo and
redo.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">undo-tree</span>
  <span style="color: #729fcf;">:init</span>
  (global-undo-tree-mode +1)
  <span style="color: #729fcf;">:bind</span> (<span style="color: #de7fa8;">"C-c u"</span> . undo-tree-visualize)
  <span style="color: #729fcf;">:diminish</span> undo-tree-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-31" class="outline-4">
<h4 id="sec-5-4-31"><span class="section-number-4">5.4.31</span> Uniquify</h4>
<div class="outline-text-4" id="text-5-4-31">
<p>
Distinguish buffers with the same name.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">uniquify</span>
  <span style="color: #729fcf;">:config</span>
  (setq uniquify-buffer-name-style 'forward
        uniquify-separator <span style="color: #de7fa8;">"/"</span>
        uniquify-after-kill-buffer-p t
        uniquify-ignore-buffers-re <span style="color: #de7fa8;">"^\\*"</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-32" class="outline-4">
<h4 id="sec-5-4-32"><span class="section-number-4">5.4.32</span> Volatile-highlights</h4>
<div class="outline-text-4" id="text-5-4-32">
<p>
This package highlights changes just made to the buffer and the
highlights dispear at the next command.  It gives you a visual
feedback what is being changed.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">volatile-highlights</span>
  <span style="color: #729fcf;">:config</span>
  (volatile-highlights-mode t)
  <span style="color: #729fcf;">:diminish</span> volatile-highlights-mode)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5-4-33" class="outline-4">
<h4 id="sec-5-4-33"><span class="section-number-4">5.4.33</span> Writeroom-mode</h4>
<div class="outline-text-4" id="text-5-4-33">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">use-package</span> <span style="color: #73d216;">writeroom-mode</span>
  <span style="color: #729fcf;">:bind</span> (<span style="color: #de7fa8;">"C-c w"</span> . writeroom-mode)
  <span style="color: #729fcf;">:config</span> (setq writeroom-width (+ fill-column 10)))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec:editorsetting" class="outline-2">
<h2 id="sec:editorsetting"><a id="sec-6" name="sec-6"></a><span class="section-number-2">6</span> Editor Setting</h2>
<div class="outline-text-2" id="text-sec:editorsetting">

<p>
After the above preparations, we continue to customize the default
behaviours of our editor.  First and formost, I would like to avoid
accidentally closing Emacs.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq confirm-kill-emacs 'yes-or-no-p)
</pre>
</div>

<p>
Some wired erros might occur, sometimes I just want to see where
they actually originate from.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq debug-on-error t)
</pre>
</div>

<p>
Then load the theme package and enable <code>Hl-mode</code>.  The face has to be
set after loading the themes.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(load-theme 'naquadah t)
(global-hl-line-mode +1)
(set-face-background 'hl-line <span style="color: #de7fa8;">"#3B3D3A"</span>)
(set-face-foreground 'highlight nil)
</pre>
</div>
</div>

<div id="outline-container-sec:encoding_font" class="outline-3">
<h3 id="sec:encoding_font"><a id="sec-6-1" name="sec-6-1"></a><span class="section-number-3">6.1</span> Encoding and Font</h3>
<div class="outline-text-3" id="text-sec:encoding_font">

<p>
First of all, it is the encoding system that matters.
</p>

<p>
I will stick to <code>utf-8</code> whenever possible.  In case of Chinese,
however, the default encoding under MS Windows is <code>cp936</code> (for
Simplified Chinese) and <code>cp950</code> (for Big5), <code>gb18030</code> and <code>gb2312</code> in
some cases.  I include them in the coding system in order to open
these files correctly.  And note that <code>prefer-coding-system</code> always
prefers the last preferred encoding, <code>utf-8</code> in the following code.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">let</span> ((my-prefer-coding-system
       '(cp950 gb2312 cp936 gb18030 utf-16 utf-8)))
  (<span style="color: #729fcf; font-weight: bold;">dolist</span> (c my-prefer-coding-system)
    (prefer-coding-system c)))
</pre>
</div>

<p>
Then comes the font for both English and Chinese.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(set-face-attribute 'default nil
                    <span style="color: #729fcf;">:font</span> <span style="color: #de7fa8;">"Ubuntu Mono:pixelsize=16"</span>)

(<span style="color: #729fcf; font-weight: bold;">dolist</span> (charset '(kana han symbol cjk-misc bopomofo))
  (set-fontset-font
   (frame-parameter nil 'font)
   charset (font-spec <span style="color: #729fcf;">:family</span> <span style="color: #de7fa8;">"WenQuanYi Zen Hei Mono"</span>
                      <span style="color: #729fcf;">:size</span> 16)))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec:default_behaviour" class="outline-3">
<h3 id="sec:default_behaviour"><a id="sec-6-2" name="sec-6-2"></a><span class="section-number-3">6.2</span> Default Behaviours</h3>
<div class="outline-text-3" id="text-sec:default_behaviour">

<p>
Next is the tab thing.  Although I do not use <code>\t</code> for indentation, I
still set the <code>tab-width</code> in case I need it, e.g., Makefile.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq-default indent-tabs-mode nil)
(setq-default tab-width 8)
(setq-default tab-stop-list (number-sequence 2 120 2))
</pre>
</div>

<p>
Typing overwrites selected text.  Expected behaviour of most editors.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(delete-selection-mode t)
</pre>
</div>

<p>
Leaving double space after <code>.</code> makes it easier to delete a whole line
with <kbd>M-k</kbd>.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq colon-double-space t)
</pre>
</div>

<p>
Cleanup spaces and write timestamp if needed.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-hook 'before-save-hook
          (<span style="color: #729fcf; font-weight: bold;">lambda</span> ()
            (delete-trailing-whitespace)
            (time-stamp)))

(setq tab-always-indent 'complete)
(blink-cursor-mode 0)
(setq scroll-preserve-screen-position t)
(setq require-final-newline t)
(mouse-avoidance-mode 'animate)
(setq blink-matching-paren nil)
</pre>
</div>

<p>
I do not need tool bar but I find menu bar helpful in case I forget
what operations are available in a major mode.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(tool-bar-mode 0)
(menu-bar-mode 1)
</pre>
</div>

<p>
I do not need the scroll bar either.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(scroll-bar-mode 0)
(setq scroll-margin 0
      scroll-preserve-screen-position 1)
</pre>
</div>

<p>
Turn on <code>subword-mode</code> so that <kbd>C-right</kbd> moves in step of a
subword.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(global-subword-mode 1)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq frame-title-format
      '(<span style="color: #de7fa8;">"emacs%@"</span>
        (<span style="color: #729fcf;">:eval</span> (system-name)) <span style="color: #de7fa8;">": "</span>
        (<span style="color: #729fcf;">:eval</span>
         (<span style="color: #729fcf; font-weight: bold;">if</span> (buffer-file-name) (abbreviate-file-name (buffer-file-name))
           <span style="color: #de7fa8;">"%b"</span>)) <span style="color: #de7fa8;">" [%*]"</span>))

(setq visible-bell t)

(setq inhibit-startup-message t
      resize-mini-windows t)

(column-number-mode 1)
(setq size-indication-mode t)

(fset 'yes-or-no-p 'y-or-n-p)

(file-name-shadow-mode t)

(put 'narrow-to-region 'disabled nil)
(put 'narrow-to-page 'disabled nil)
(put 'narrow-to-defun 'disabled nil)
(put 'upcase-region 'disabled nil)
(put 'downcase-region 'disabled nil)
</pre>
</div>

<p>
Many of the settings above are rather self-evident.  The following
<i>advice</i> is for <kbd>M-w</kbd>, copy command in Emacs.  By default,
<kbd>M-w</kbd> operates on a selected region and does nothing when no
text is selected.  Instead of doing nothing, we <i>advice</i> it to copy
current line. i.e., where cursor resides, when no region is active.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">defadvice</span> <span style="color: #fcaf3e; font-weight: bold;">kill-ring-save</span>
    (before slick-copy activate compile)
  <span style="color: #babdb6; font-style: italic;">"When called interactively with no active region, copy a single</span>
<span style="color: #babdb6; font-style: italic;">         line instead."</span>
  (interactive
   (<span style="color: #729fcf; font-weight: bold;">if</span> mark-active
       (list (region-beginning)
             (region-end))
     (message <span style="color: #de7fa8;">"Copied line"</span>)
     (list (line-beginning-position)
           (line-beginning-position 2)))))
</pre>
</div>

<p>
Backup files in the temp directory instead of clustering everywhere
with tild-ended files.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq backup-directory-alist `((<span style="color: #de7fa8;">".*"</span> . ,my-tmp)))
(setq auto-save-list-file-prefix
      (expand-file-name <span style="color: #de7fa8;">".saves-"</span> my-tmp))

(setq backup-by-copying t
      delete-old-versions t
      kept-new-versions 6
      kept-old-versions 2
      version-control t)
</pre>
</div>

<p>
Open read-only files in <code>view-mode</code> minor mode.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(setq view-read-only t)
</pre>
</div>

<p>
I do not show line numbers at the margin as I do not care.  But I do
care when I want to jump to a certain line in the buffer.  So show me
the line numbers only when I'm about to jump to a line.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(<span style="color: #729fcf; font-weight: bold;">defun</span> <span style="color: #fcaf3e; font-weight: bold;">goto-line-with-feedback</span> ()
  <span style="color: #babdb6; font-style: italic;">"Show line numbers temporarily, while prompting for the line</span>
<span style="color: #babdb6; font-style: italic;">         number input"</span>
  (interactive)
  (<span style="color: #729fcf; font-weight: bold;">unwind-protect</span>
      (<span style="color: #729fcf; font-weight: bold;">progn</span>
        (linum-mode 1)
        (goto-line (read-number <span style="color: #de7fa8;">"Goto line: "</span>)))
    (linum-mode -1)))

(global-set-key [remap goto-line] 'goto-line-with-feedback)
</pre>
</div>

<p>
Turn on <code>auto-fill-mode</code> by default.  For <i>historical</i> (unknown)
reasons, <code>auto-fill-mode</code> is named by "auto-fill-function".
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(diminish 'auto-fill-function)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec:key" class="outline-3">
<h3 id="sec:key"><a id="sec-6-3" name="sec-6-3"></a><span class="section-number-3">6.3</span> Key bindings</h3>
<div class="outline-text-3" id="text-sec:key">
</div>

<div id="outline-container-sec-6-3-1" class="outline-4">
<h4 id="sec-6-3-1"><span class="section-number-4">6.3.1</span> Function Key Bindings</h4>
<div class="outline-text-4" id="text-6-3-1">
<p>
Keybindings for <kbd>Fn</kbd> keys.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(global-set-key (kbd <span style="color: #de7fa8;">"&lt;f6&gt;"</span>) 'calendar)
(global-set-key (kbd <span style="color: #de7fa8;">"&lt;f7&gt;"</span>) 'compile)
(global-set-key (kbd <span style="color: #de7fa8;">"&lt;f8&gt;"</span>) 'deft)
<span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">f9 -- helm-recentf</span>
<span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">f10 -- menu</span>
(global-set-key (kbd <span style="color: #de7fa8;">"&lt;f11&gt;"</span>) 'ispell)
<span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">f12 -- gnus-other-frame)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-3-2" class="outline-4">
<h4 id="sec-6-3-2"><span class="section-number-4">6.3.2</span> Improved Standard Bindings</h4>
<div class="outline-text-4" id="text-6-3-2">
<div class="org-src-container">

<pre class="src src-emacs-lisp">(global-set-key [remap execute-extended-command] #'helm-M-x)
(global-set-key [remap switch-to-buffer] #'helm-mini)
(global-set-key [remap find-file] #'helm-find-files)
(global-set-key [remap list-buffers] #'ibuffer)
(global-set-key [remap isearch-forward] #'isearch-forward-regexp)
(global-set-key [remap isearch-backward] #'isearch-query-replace-regexp)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-3-3" class="outline-4">
<h4 id="sec-6-3-3"><span class="section-number-4">6.3.3</span> User Key Bindings</h4>
<div class="outline-text-4" id="text-6-3-3">
<p>
User key bindings usually begin with <kbd>C-c</kbd>.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">C-c a -- my-ag-map</span>
(global-set-key (kbd <span style="color: #de7fa8;">"C-c g"</span>) #'ace-jump-mode)
<span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">C-k k -- browse-kill-ring</span>
<span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">C-c m -- my-multiple-cursor-map</span>
(global-set-key (kbd <span style="color: #de7fa8;">"C-c q"</span>) #'auto-fill-mode)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c r"</span>) #'isearch-query-replace-regexp)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c o a"</span>) #'org-agenda)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c o c"</span>) #'org-capture)
<span style="color: #babdb6; font-style: italic;">;; </span><span style="color: #babdb6; font-style: italic;">C-c w -- writeroom-mode</span>
(global-set-key (kbd <span style="color: #de7fa8;">"C-c ,"</span>) #'color-identifiers-mode)

(global-set-key (kbd <span style="color: #de7fa8;">"C-c C-="</span>) #'align-regexp)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c C-/"</span>)
                (function
                 (<span style="color: #729fcf; font-weight: bold;">lambda</span> ()
                   (interactive)
                   (my-apply-region-or-line
                    'comment-or-uncomment-region))))
(global-set-key (kbd <span style="color: #de7fa8;">"C-c C-\\"</span>)
                (function
                 (<span style="color: #729fcf; font-weight: bold;">lambda</span> ()
                   (interactive)
                   (my-apply-region-or-para
                    'indent-region))))

(global-set-key (kbd <span style="color: #de7fa8;">"C-c &lt;left&gt;"</span>) #'decrease-left-margin)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c &lt;right&gt;"</span>) #'increase-left-margin)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c C-&lt;left&gt;"</span>) #'decrease-left-margin)
(global-set-key (kbd <span style="color: #de7fa8;">"C-c C-&lt;right&gt;"</span>) #'increase-left-margin)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6-3-4" class="outline-4">
<h4 id="sec-6-3-4"><span class="section-number-4">6.3.4</span> Key logger</h4>
<div class="outline-text-4" id="text-6-3-4">
<p>
Sometimes I want to analyze my Emacs key press frequency.  The
builtin function <code>open-dribble-file</code> does exactly what I want.  But
be aware that it logs <i>everything</i>, literally, <i>everything</i>
including your passwords.  So you may remove this section from your
configuration files.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(open-dribble-file
 (expand-file-name
  (format-time-string <span style="color: #de7fa8;">"~/.emacs.d/.keylog/key-%FT%H%M%S.log"</span>)))
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> End</h2>
<div class="outline-text-2" id="text-7">
<p>
After all these things, start the server.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">(add-hook 'after-init-hook 'server-start t)
</pre>
</div>

<hr >
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" name="fn.1" class="footnum" href="#fnr.1">1</a></sup> <p class="footpara">
As a side note, I guess his blog style might be adopted from
<a href="http://doc.norang.ca/">Bernt Hansen</a> blog site.  Correct me if I'm wrong.
</p></div>


</div>
</div></div>
<div id="postamble" class="status">
<a class="author"
       href="http://gongzhitaao.org">Zhitao Gong</a> / <span
       class="date">2015-07-28 Tue 15:16</span><span class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.4.1 (<a href="http://orgmode.org">Org</a> mode 8.2.10)</span>
</div>
</body>
</html>
